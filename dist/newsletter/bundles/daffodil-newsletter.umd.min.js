!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store"),require("@angular/core"),require("@angular/common"),require("@ngrx/effects"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http"),require("@angular/platform-browser"),require("@angular/router"),require("@daffodil/driver/hubspot")):"function"==typeof define&&define.amd?define("@daffodil/newsletter",["exports","@ngrx/store","@angular/core","@angular/common","@ngrx/effects","rxjs","rxjs/operators","@angular/common/http","@angular/platform-browser","@angular/router","@daffodil/driver/hubspot"],t):t(((e=e||self).daffodil=e.daffodil||{},e.daffodil.newsletter={}),e.store,e.ng.core,e.ng.common,e.effects,e.rxjs,e.rxjs.operators,e.ng.common.http,e.ng.platformBrowser,e.ng.router,e.hubspot)}(this,function(e,t,r,o,s,n,i,c,a,u,l){"use strict";var f=function(){return(f=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};var d={NewsletterSubscribeAction:"[Daff-Newsletter] Newsletter Subscribe Action",NewsletterCancelAction:"[Daff-Newsletter] Newsletter Cancel Action",NewsletterSuccessSubscribeAction:"[Daff-Newsletter] Succeeded on Newsletter Subscribe Action",NewsletterFailedSubscribeAction:"[Daff-Newsletter] Failed on Newsletter Subscribe Action",NewsletterRetry:"[Daff-Newsletter] Retrying submission",NewsletterReset:"[Daff-Newsletter] Reset Newsletter"},p=function(e){this.payload=e,this.type=d.NewsletterSubscribeAction};var w=function(e){this.payload=e,this.type=d.NewsletterRetry};var b=function(){this.type=d.NewsletterCancelAction};var N=function(e){this.payload=e,this.type=d.NewsletterFailedSubscribeAction};var y=function(){this.type=d.NewsletterSuccessSubscribeAction};var h=function(){this.type=d.NewsletterReset};var g={success:!1,loading:!1,error:null};function S(e,t){switch(void 0===e&&(e=g),t.type){case d.NewsletterRetry:case d.NewsletterSubscribeAction:return f({},e,{loading:!0});case d.NewsletterFailedSubscribeAction:return f({},e,{loading:!1,error:t.payload});case d.NewsletterCancelAction:return f({},e,{loading:!1});case d.NewsletterSuccessSubscribeAction:return f({},e,{success:!0,loading:!1});case d.NewsletterReset:return f({},e,g);default:return e}}var v=t.createFeatureSelector("newsletter"),m=t.createSelector(v,function(e){return e.loading}),D=t.createSelector(v,function(e){return e.error}),A=t.createSelector(v,function(e){return e.success}),j=function(){function e(e){this.hubspotService=e}return e.prototype.send=function(e){return this.hubspotService.submit(e)},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:l.DaffHubspotFormsService}]},e}();var F=new r.InjectionToken("DaffNewsletterDriver");var x=new r.InjectionToken("DaffNewsletterConfig"),C=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:F,useClass:j},{provide:x,useValue:t},{provide:l.DaffHubspotFormsService,useFactory:l.daffHubspotFormsServiceFactory,deps:[c.HttpClient,o.DOCUMENT,u.Router,a.Title,x]}]}},e.decorators=[{type:r.NgModule,args:[{imports:[o.CommonModule]}]}],e}(),R=function(){function e(e,t){var r=this;this.actions$=e,this.driver=t,this.trySubmission$=s.createEffect(function(){return r.actions$.pipe(s.ofType(d.NewsletterSubscribeAction,d.NewsletterRetry,d.NewsletterCancelAction),i.switchMap(function(e){return e.type===d.NewsletterCancelAction?n.of(e):e instanceof p||e instanceof w?r.driver.send(e.payload).pipe(i.map(function(e){return new y}),i.catchError(function(e){return n.of(new N("Failed to subscribe to newsletter"))})):void 0}),s.ofType(d.NewsletterFailedSubscribeAction,d.NewsletterSuccessSubscribeAction))})}return e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:s.Actions},{type:void 0,decorators:[{type:r.Inject,args:[F]}]}]},e}();var M=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[o.CommonModule,t.StoreModule.forFeature("newsletter",S),s.EffectsModule.forFeature([R])]}]}],e}(),q=function(){function e(e){this.store=e,this.success$=this.store.select(A),this.error$=this.store.select(D),this.loading$=this.store.select(m)}return e.prototype.dispatch=function(e){this.store.dispatch(e)},e.decorators=[{type:r.Injectable,args:[{providedIn:M}]}],e.ctorParameters=function(){return[{type:t.Store}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(t.Store))},token:e,providedIn:M}),e}();e.DaffNewsletterActionTypes=d,e.DaffNewsletterCancel=b,e.DaffNewsletterDriver=F,e.DaffNewsletterFacade=q,e.DaffNewsletterFailedSubscribe=N,e.DaffNewsletterHubSpotDriverModule=C,e.DaffNewsletterModule=M,e.DaffNewsletterReset=h,e.DaffNewsletterRetry=w,e.DaffNewsletterSubscribe=p,e.DaffNewsletterSuccessSubscribe=y,e.reducer=S,e.selectDaffNewsletterError=D,e.selectDaffNewsletterLoading=m,e.selectDaffNewsletterSuccess=A,e.ɵa=R,e.ɵb=j,e.ɵc=x,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-newsletter.umd.min.js.map