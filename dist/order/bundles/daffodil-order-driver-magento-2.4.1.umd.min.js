!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@daffodil/core"),require("@daffodil/order"),require("graphql-tag"),require("@daffodil/core/graphql"),require("@angular/core"),require("apollo-angular"),require("rxjs"),require("rxjs/operators"),require("@daffodil/order/driver"),require("@daffodil/driver/magento"),require("@daffodil/cart/driver"),require("@angular/common")):"function"==typeof define&&define.amd?define("@daffodil/order/driver/magento/2.4.1",["exports","@daffodil/core","@daffodil/order","graphql-tag","@daffodil/core/graphql","@angular/core","apollo-angular","rxjs","rxjs/operators","@daffodil/order/driver","@daffodil/driver/magento","@daffodil/cart/driver","@angular/common"],n):n(((e=e||self).daffodil=e.daffodil||{},e.daffodil.order=e.daffodil.order||{},e.daffodil.order.driver=e.daffodil.order.driver||{},e.daffodil.order.driver.magento=e.daffodil.order.driver.magento||{},e.daffodil.order.driver.magento[2]=e.daffodil.order.driver.magento[2]||{},e.daffodil.order.driver.magento[2][4]=e.daffodil.order.driver.magento[2][4]||{},e.daffodil.order.driver.magento[2][4][1]={}),e.core,e.daffodil.order,e.gql,e.graphql,e.ng.core,e.apolloAngular,e.rxjs,e.rxjs.operators,e.daffodil.order.driver,e.magento,e.driver$1,e.ng.common)}(this,function(e,n,r,t,a,o,i,d,l,u,m,s,c){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var p={Simple:"simple",Configurable:"configurable",Bundle:"bundle"};var f=this&&this.__assign||function(){return(f=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)};function _(e){return[{label:"Grand Total",type:r.DaffOrderTotalTypeEnum.GrandTotal,value:e.grand_total.value,sort_order:1},{label:"Subtotal",type:r.DaffOrderTotalTypeEnum.Subtotal,value:e.subtotal.value,sort_order:0},{label:"Shipping",type:r.DaffOrderTotalTypeEnum.Shipping,value:e.total_shipping.value,sort_order:2},{label:"Tax",type:r.DaffOrderTotalTypeEnum.Tax,value:e.total_tax.value,sort_order:3},{label:"Discount",type:r.DaffOrderTotalTypeEnum.Discount,value:e.discounts.reduce(function(e,r){return n.daffAdd(e,r.amount.value)},0),sort_order:4}]}function y(e){return{code:e.label}}function g(e){return{attribute_label:e.label,value_label:e.value}}function v(e){return{option_label:e.label,value_label:e.values&&e.values[0]&&e.values[0].product_name}}function h(e,t,a){var o=e.discounts.reduce(function(e,r){return n.daffAdd(e,r.amount.value)},0),i=a*e.product_sale_price.value,d=a*n.daffSubtract(e.product_sale_price.value,o);return f({type:r.DaffOrderItemType.Simple,item_id:null,qty_ordered:e.quantity_ordered,qty_canceled:e.quantity_canceled,qty_fulfilled:e.quantity_shipped,qty:a,image:{url:e.product_url_key,id:null,label:null},order_id:t.id,created_at:null,updated_at:null,product_id:null,parent_item_id:null,sku:e.product_sku,name:e.product_name,weight:null,price:e.product_sale_price.value,discount_percent:Math.floor(o/e.product_sale_price.value*100),discount_amount:o,tax_percent:null,tax_amount:null,row_total:i,row_total_with_discount:d,row_weight:null,tax_before_discount:null},function(e){switch(e.product_type){case p.Bundle:return{type:r.DaffOrderItemType.Composite,options:e.bundle_options.map(v)};case p.Configurable:return{type:r.DaffOrderItemType.Configurable,attributes:e.selected_options.map(g)};case p.Simple:return{type:r.DaffOrderItemType.Simple};default:return{}}}(e))}function b(e,n){return{order_id:n.id,prefix:e.prefix,suffix:e.suffix,firstname:e.firstname,middlename:e.middlename,lastname:e.lastname,telephone:e.telephone,email:null,street:e.street[0],street2:e.street[1],city:e.city,region:e.region_id,country:e.country_code,postcode:e.postcode}}function O(e){return{tracking_number:e.number,tracking_url:null,carrier:e.carrier,title:e.title,carrier_logo:null}}function I(e,n){return{carrier:n.carrier,carrier_title:null,code:null,method:n.shipping_method,method_description:null,tracking:e.tracking.map(O),items:e.items.map(function(e){return function(e,n){return{item:h(e.order_item,n,e.quantity_shipped),qty:e.quantity_shipped}}(e,n)})}}function j(e,n){var r=function(n){var r=e.additional_data.findIndex(function(e){return e.name===n});return r>-1?e.additional_data[r].value:null};return{payment_id:null,order_id:n.id,created_at:null,updated_at:null,method:e.type,cc_type:r("cc_type"),cc_last4:r("cc_last4"),cc_owner:r("cc_owner"),cc_exp_month:r("cc_exp_month"),cc_exp_year:r("cc_exp_year")}}function T(e,n,r){return{totals:_(e.total),billing_address:b(n.billing_address,n),shipping_address:b(n.shipping_address,n),payment:j(r,n),items:e.items.map(function(e){return function(e,n){return{item:h(e.order_item,n,e.quantity_invoiced),qty:e.quantity_invoiced}}(e,n)}),shipping_method:null}}function q(e,n){return{totals:_(e.total),billing_address:b(n.billing_address,n),shipping_address:b(n.shipping_address,n),payment:j(n.payment_methods[0],n),items:e.items.map(function(e){return function(e,n){return{item:h(e.order_item,n,e.quantity_refunded),qty:e.quantity_refunded}}(e,n)}),shipping_method:null}}function w(e){return{extra_attributes:e,id:e.number,customer_id:null,updated_at:null,created_at:e.order_date,status:e.status,totals:_(e.total),applied_codes:e.total.discounts.map(y),items:e.items.map(function(n){return h(n,e,n.quantity_ordered)}),billing_addresses:[b(e.billing_address,e)],shipping_addresses:[b(e.shipping_address,e)],shipments:e.shipments.map(function(n){return I(n,e)}),payment:j(e.payment_methods[0],e),invoices:e.invoices.map(function(n,r){return T(n,e,e.payment_methods[r])}),credits:e.credit_memos.map(function(n){return q(n,e)})}}var x,S,P,k,C,D,M,A,G,F,E,B,$,N,R,z,H,J=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},K=t(x||(x=J(["\n  fragment orderBundleItemSelectedOption on ItemSelectedBundleOption {\n    __typename\n    id\n    label\n    values {\n      __typename\n      id\n      product_name\n    }\n  }\n"],["\n  fragment orderBundleItemSelectedOption on ItemSelectedBundleOption {\n    __typename\n    id\n    label\n    values {\n      __typename\n      id\n      product_name\n    }\n  }\n"]))),L=t(S||(S=J(["\n  fragment orderItem on OrderItemInterface {\n    __typename\n    id\n    quantity_ordered\n    quantity_canceled\n    quantity_shipped\n    quantity_invoiced\n    product_url_key\n    product_sku\n    product_name\n    product_type\n    product_sale_price {\n      value\n    }\n    discounts {\n      amount {\n        value\n      }\n    }\n    selected_options {\n      label\n      value\n    }\n    ... on BundleOrderItem {\n      bundle_options {\n        ...orderBundleItemSelectedOption\n      }\n    }\n  }\n  ","\n"],["\n  fragment orderItem on OrderItemInterface {\n    __typename\n    id\n    quantity_ordered\n    quantity_canceled\n    quantity_shipped\n    quantity_invoiced\n    product_url_key\n    product_sku\n    product_name\n    product_type\n    product_sale_price {\n      value\n    }\n    discounts {\n      amount {\n        value\n      }\n    }\n    selected_options {\n      label\n      value\n    }\n    ... on BundleOrderItem {\n      bundle_options {\n        ...orderBundleItemSelectedOption\n      }\n    }\n  }\n  ","\n"])),K),Q=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},U=t(P||(P=Q(["\n  fragment orderAddress on OrderAddress {\n    __typename\n    city\n    company\n    country_code\n    fax\n    firstname\n    middlename\n    lastname\n    postcode\n    prefix\n    region\n    region_id\n    street\n    suffix\n    telephone\n  }\n"],["\n  fragment orderAddress on OrderAddress {\n    __typename\n    city\n    company\n    country_code\n    fax\n    firstname\n    middlename\n    lastname\n    postcode\n    prefix\n    region\n    region_id\n    street\n    suffix\n    telephone\n  }\n"]))),V=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},W=t(k||(k=V(["\n  fragment orderShipmentItem on ShipmentItemInterface {\n    __typename\n    id\n    quantity_shipped\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"],["\n  fragment orderShipmentItem on ShipmentItemInterface {\n    __typename\n    id\n    quantity_shipped\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"])),L),X=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},Y=t(C||(C=X(["\n  fragment orderShipmentTracking on ShipmentTracking {\n    __typename\n    number\n    carrier\n    title\n  }\n"],["\n  fragment orderShipmentTracking on ShipmentTracking {\n    __typename\n    number\n    carrier\n    title\n  }\n"]))),Z=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ee=t(D||(D=Z(["\n  fragment orderShipment on OrderShipment {\n    __typename\n    id\n    tracking {\n      ...orderShipmentTracking\n    }\n    items {\n      ...orderShipmentItem\n    }\n  }\n  ","\n  ","\n"],["\n  fragment orderShipment on OrderShipment {\n    __typename\n    id\n    tracking {\n      ...orderShipmentTracking\n    }\n    items {\n      ...orderShipmentItem\n    }\n  }\n  ","\n  ","\n"])),W,Y),ne=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},re=t(M||(M=ne(["\n  fragment orderPayment on OrderPaymentMethod {\n    __typename\n    name\n    type\n    additional_data {\n      name\n      value\n    }\n  }\n"],["\n  fragment orderPayment on OrderPaymentMethod {\n    __typename\n    name\n    type\n    additional_data {\n      name\n      value\n    }\n  }\n"]))),te=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ae=t(A||(A=te(["\n  fragment orderInvoiceItem on InvoiceItemInterface {\n    __typename\n    id\n    quantity_invoiced\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"],["\n  fragment orderInvoiceItem on InvoiceItemInterface {\n    __typename\n    id\n    quantity_invoiced\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"])),L),oe=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ie=t(G||(G=oe(["\n  fragment orderInvoiceTotal on InvoiceTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"],["\n  fragment orderInvoiceTotal on InvoiceTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"]))),de=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},le=t(F||(F=de(["\n  fragment orderInvoice on Invoice {\n    __typename\n    id\n    items {\n      ...orderInvoiceItem\n    }\n    total {\n      ...orderInvoiceTotal\n    }\n  }\n  ","\n  ","\n"],["\n  fragment orderInvoice on Invoice {\n    __typename\n    id\n    items {\n      ...orderInvoiceItem\n    }\n    total {\n      ...orderInvoiceTotal\n    }\n  }\n  ","\n  ","\n"])),ae,ie),ue=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},me=t(E||(E=ue(["\n  fragment orderCreditItem on CreditMemoItemInterface {\n    __typename\n    id\n    quantity_refunded\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"],["\n  fragment orderCreditItem on CreditMemoItemInterface {\n    __typename\n    id\n    quantity_refunded\n    order_item {\n      ...orderItem\n    }\n  }\n  ","\n"])),L),se=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ce=t(B||(B=se(["\n  fragment orderCreditTotal on CreditMemoTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"],["\n  fragment orderCreditTotal on CreditMemoTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"]))),pe=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},fe=t($||($=pe(["\n  fragment orderCredit on CreditMemo {\n    __typename\n    id\n    items {\n      ...orderCreditItem\n    }\n    total {\n      ...orderCreditTotal\n    }\n  }\n  ","\n  ","\n"],["\n  fragment orderCredit on CreditMemo {\n    __typename\n    id\n    items {\n      ...orderCreditItem\n    }\n    total {\n      ...orderCreditTotal\n    }\n  }\n  ","\n  ","\n"])),me,ce),_e=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ye=t(N||(N=_e(["\n  fragment orderTotal on OrderTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"],["\n  fragment orderTotal on OrderTotal {\n    __typename\n    discounts {\n      amount {\n        value\n      }\n      label\n    }\n    grand_total {\n      value\n    }\n    subtotal {\n      value\n    }\n    total_tax {\n      value\n    }\n    total_shipping {\n      value\n    }\n  }\n"]))),ge=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ve=t(R||(R=ge(["\n  fragment order on GraycoreGuestOrder {\n    __typename\n    id\n    order_date\n    status\n    carrier\n    number\n    shipping_method\n    items {\n      ...orderItem\n    }\n    billing_address {\n      ...orderAddress\n    }\n    shipping_address {\n      ...orderAddress\n    }\n    shipments {\n      ...orderShipment\n    }\n    payment_methods {\n      ...orderPayment\n    }\n    invoices {\n      ...orderInvoice\n    }\n    credit_memos {\n      ...orderCredit\n    }\n    total {\n      ...orderTotal\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"],["\n  fragment order on GraycoreGuestOrder {\n    __typename\n    id\n    order_date\n    status\n    carrier\n    number\n    shipping_method\n    items {\n      ...orderItem\n    }\n    billing_address {\n      ...orderAddress\n    }\n    shipping_address {\n      ...orderAddress\n    }\n    shipments {\n      ...orderShipment\n    }\n    payment_methods {\n      ...orderPayment\n    }\n    invoices {\n      ...orderInvoice\n    }\n    credit_memos {\n      ...orderCredit\n    }\n    total {\n      ...orderTotal\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),L,ee,re,le,fe,U,ye),he=this&&this.__makeTemplateObject||function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},be=this&&this.__read||function(e,n){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var t,a,o=r.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(t=o.next()).done;)i.push(t.value)}catch(e){a={error:e}}finally{try{t&&!t.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i},Oe=this&&this.__spread||function(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(be(arguments[n]));return e},Ie=function(e){return void 0===e&&(e=[]),t(z||(z=he(["\n  query GetGuestOrders($cartId: String!) {\n    graycoreGuestOrders(cartId: $cartId) {\n      items {\n        ...order\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  query GetGuestOrders($cartId: String!) {\n    graycoreGuestOrders(cartId: $cartId) {\n      items {\n        ...order\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),a.daffBuildFragmentNameSpread.apply(void 0,Oe(e)),ve,a.daffBuildFragmentDefinition.apply(void 0,Oe(e)))},je=new o.InjectionToken("DaffMagentoExtraOrderFragments",{factory:function(){return[]}}),Te=function(e){if(e.data.graycoreGuestOrders.items){if(e.data.graycoreGuestOrders.items.reduce(function(e,n){return e&&!!(n.billing_address&&n.shipping_address&&n.payment_methods)},!0))return e;throw new u.DaffOrderInvalidAPIResponseError("One of the orders does not contain required fields.")}throw new u.DaffOrderInvalidAPIResponseError("Get orders response does not contain a valid list of orders.")},qe=((H={})["graphql-no-such-entity"]=s.DaffCartNotFoundError,H);var we=this&&this.__values||function(e){var n="function"==typeof Symbol&&e[Symbol.iterator],r=0;return n?n.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},xe=function(){function e(e,n){this.apollo=e,this.extraOrderFragments=n}return e.prototype.list=function(e){return this.apollo.query({query:Ie(this.extraOrderFragments),variables:{cartId:e}}).pipe(l.map(Te),l.map(function(e){return e.data.graycoreGuestOrders.items.map(w)}),l.catchError(function(e){return d.throwError((n=e,m.daffTransformMagentoError(n,qe)));var n}))},e.prototype.get=function(e,n){return this.list(n).pipe(l.map(function(n){var r,t;try{for(var a=we(n),o=a.next();!o.done;o=a.next()){var i=o.value;if(String(i.id)===String(e))return i}}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}throw new u.DaffOrderNotFoundError("Could not find an order with ID "+e)}))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:i.Apollo},{type:Array,decorators:[{type:o.Inject,args:[je]}]}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(i.Apollo),o.ɵɵinject(je))},token:e,providedIn:"root"}),e}();var Se=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[{provide:u.DaffOrderDriver,useExisting:xe}]}},e.decorators=[{type:o.NgModule,args:[{imports:[c.CommonModule]}]}],e}();e.DaffMagentoExtraOrderFragments=je,e.DaffOrderMagentoDriverModule=Se,e.DaffOrderMagentoService=xe,e.MagentoOrderItemType=p,e.daffMagentoTransformOrder=w,e.getGuestOrders=Ie,e.orderAddressFragment=U,e.orderFragment=ve,e.orderInvoiceFragment=le,e.orderItemFragment=L,e.orderPaymentFragment=re,e.orderShipmentFragment=ee,e.orderShipmentItemFragment=W,e.orderShipmentTrackingFragment=Y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-order-driver-magento-2.4.1.umd.min.js.map