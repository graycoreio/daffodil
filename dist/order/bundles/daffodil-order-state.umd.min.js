!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/entity"),require("@ngrx/store"),require("@daffodil/order"),require("@daffodil/cart/state"),require("@angular/core"),require("@angular/router"),require("rxjs/operators"),require("@ngrx/effects"),require("rxjs"),require("@daffodil/order/driver")):"function"==typeof define&&define.amd?define("@daffodil/order/state",["exports","@ngrx/entity","@ngrx/store","@daffodil/order","@daffodil/cart/state","@angular/core","@angular/router","rxjs/operators","@ngrx/effects","rxjs","@daffodil/order/driver"],t):t(((e=e||self).daffodil=e.daffodil||{},e.daffodil.order=e.daffodil.order||{},e.daffodil.order.state={}),e.entity,e.store,e.daffodil.order,e.state,e.ng.core,e.ng.router,e.rxjs.operators,e.effects,e.rxjs,e.daffodil.order.driver)}(this,function(e,t,r,i,o,n,s,c,d,a,l){"use strict";var u={OrderLoadAction:"[Order] Order Load Action",OrderLoadSuccessAction:"[Order] Order Load Success Action",OrderLoadFailureAction:"[Order] Order Load Failure Action",OrderListAction:"[Order] Order List Action",OrderListSuccessAction:"[Order] Order List Success Action",OrderListFailureAction:"[Order] Order List Failure Action"},f=function(e,t){this.orderId=e,this.cartId=t,this.type=u.OrderLoadAction};var p=function(e){this.payload=e,this.type=u.OrderLoadSuccessAction};var h=function(e){this.payload=e,this.type=u.OrderLoadFailureAction};var O=function(e){this.payload=e,this.type=u.OrderListAction};var y=function(e){this.payload=e,this.type=u.OrderListSuccessAction};var g=function(e){this.payload=e,this.type=u.OrderListFailureAction};var v={loading:!1,errors:[]},S=this&&this.__assign||function(){return(S=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s},A=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e};function j(e,t){switch(void 0===e&&(e=v),t.type){case u.OrderListAction:case u.OrderLoadAction:return S({},e,{loading:!0});case u.OrderListSuccessAction:case u.OrderLoadSuccessAction:return S({},e,{loading:!1,errors:[]});case u.OrderListFailureAction:case u.OrderLoadFailureAction:return S({},e,{errors:A(e.errors,[t.payload]),loading:!1});default:return e}}var T,m=function(){return T=T||t.createEntityAdapter()},I=m().getInitialState();function L(e,t){void 0===e&&(e=I);var r=m();switch(t.type){case u.OrderLoadSuccessAction:return r.upsertOne(t.payload,e);case u.OrderListSuccessAction:return r.upsertMany(t.payload,e);default:return e}}var D={order:j,orders:L};var $=function(){var e;return function(){return e=e||{selectOrderFeatureState:r.createFeatureSelector("daffOrder")}}}();var b=function(){var e=$().selectOrderFeatureState,t=r.createSelector(e,function(e){return e.orders}),n=m().getSelectors(t),s=n.selectIds,c=n.selectEntities,d=n.selectAll,a=n.selectTotal,l=o.getDaffCartSelectors().selectCartOrderId,u=r.createSelector(c,function(e,t){return e[t.id]||null}),f=r.createSelector(c,l,function(e,t){return t?u.projector(e,{id:t}):null}),p=r.createSelector(f,function(e){return!!e}),h=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.totals||[]}),O=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.applied_codes||[]}),y=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.items||[]}),g=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.billing_addresses||[]}),v=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.shipping_addresses||[]}),S=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.shipments||[]}),_=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.payment||null}),A=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.invoices||[]}),j=r.createSelector(c,function(e,t){var r=u.projector(e,{id:t.id});return r&&r.credits||[]}),T=r.createSelector(c,function(e,t){var r=h.projector(e,{id:t.id}),o=r.findIndex(function(e){return e.type===i.DaffOrderTotalTypeEnum.GrandTotal});return o>-1?r[o]:null}),I=r.createSelector(c,function(e,t){var r=h.projector(e,{id:t.id}),o=r.findIndex(function(e){return e.type===i.DaffOrderTotalTypeEnum.Subtotal});return o>-1?r[o]:null}),L=r.createSelector(c,function(e,t){var r=h.projector(e,{id:t.id}),o=r.findIndex(function(e){return e.type===i.DaffOrderTotalTypeEnum.Shipping});return o>-1?r[o]:null}),D=r.createSelector(c,function(e,t){var r=h.projector(e,{id:t.id}),o=r.findIndex(function(e){return e.type===i.DaffOrderTotalTypeEnum.Discount});return o>-1?r[o]:null}),b=r.createSelector(c,function(e,t){var r=D.projector(e,{id:t.id});return!!r&&r.value>0}),x=r.createSelector(c,function(e,t){var r=h.projector(e,{id:t.id}),o=r.findIndex(function(e){return e.type===i.DaffOrderTotalTypeEnum.Tax});return o>-1?r[o]:null}),E=r.createSelector(c,function(e,t){return y.projector(e,{id:t.id}).find(function(e){return e.item_id===t.item_id})||null});return{selectOrderEntitiesState:t,selectOrderIds:s,selectOrderEntities:c,selectAllOrders:d,selectOrderTotal:a,selectPlacedOrder:f,selectHasPlacedOrder:p,selectOrder:u,selectOrderTotals:h,selectOrderAppliedCodes:O,selectOrderItems:y,selectOrderBillingAddresses:g,selectOrderShippingTotalAddresses:v,selectOrderShipments:S,selectOrderPayment:_,selectOrderInvoices:A,selectOrderCredits:j,selectOrderItem:E,selectOrderGrandTotal:T,selectOrderSubtotal:I,selectOrderShippingTotal:L,selectOrderDiscountTotal:D,selectOrderHasDiscount:b,selectOrderTaxTotal:x}},x=function(){var e;return function(){return e=e||b()}}();var E=function(){var e=$().selectOrderFeatureState,t=r.createSelector(e,function(e){return e.order});return{selectOrderState:t,selectOrderLoading:r.createSelector(t,function(e){return e.loading}),selectOrderErrors:r.createSelector(t,function(e){return e.errors})}},F=function(){var e;return function(){return e=e||E()}}(),P=this&&this.__assign||function(){return(P=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};var R=function(){var e;return function(){return e=e||P({},F(),x(),$())}}(),w=function(){function e(e){this.store=e;var t=R(),i=t.selectOrderIds,o=t.selectOrderEntities,n=t.selectAllOrders,s=t.selectOrderTotal,c=t.selectOrderLoading,d=t.selectOrderErrors,a=t.selectPlacedOrder,l=t.selectHasPlacedOrder,u=t.selectOrder,f=t.selectOrderTotals,p=t.selectOrderAppliedCodes,h=t.selectOrderItems,O=t.selectOrderBillingAddresses,y=t.selectOrderShippingTotalAddresses,g=t.selectOrderShipments,v=t.selectOrderPayment,S=t.selectOrderInvoices,_=t.selectOrderCredits,A=t.selectOrderGrandTotal,j=t.selectOrderSubtotal,T=t.selectOrderShippingTotal,m=t.selectOrderDiscountTotal,I=t.selectOrderHasDiscount,L=t.selectOrderTaxTotal;this.loading$=this.store.pipe(r.select(c)),this.errors$=this.store.pipe(r.select(d)),this.orders$=this.store.pipe(r.select(n)),this.orderIds$=this.store.pipe(r.select(i)),this.orderCount$=this.store.pipe(r.select(s)),this.orderEntities$=this.store.pipe(r.select(o)),this.placedOrder$=this.store.pipe(r.select(a)),this.hasPlacedOrder$=this.store.pipe(r.select(l)),this._order=u,this._totals=f,this._appliedCodes=p,this._items=h,this._billingAddresses=O,this._shippingAddresses=y,this._shipments=g,this._payment=v,this._invoices=S,this._credits=_,this._grandTotal=A,this._subtotal=j,this._shipping=T,this._discount=m,this._hasDiscount=I,this._tax=L}return e.prototype.getOrder$=function(e){return this.store.pipe(r.select(this._order,{id:e}))},e.prototype.getTotals$=function(e){return this.store.pipe(r.select(this._totals,{id:e}))},e.prototype.getAppliedCodes$=function(e){return this.store.pipe(r.select(this._appliedCodes,{id:e}))},e.prototype.getItems$=function(e){return this.store.pipe(r.select(this._items,{id:e}))},e.prototype.getBillingAddresses$=function(e){return this.store.pipe(r.select(this._billingAddresses,{id:e}))},e.prototype.getShippingAddresses$=function(e){return this.store.pipe(r.select(this._shippingAddresses,{id:e}))},e.prototype.getShipments$=function(e){return this.store.pipe(r.select(this._shipments,{id:e}))},e.prototype.getPayment$=function(e){return this.store.pipe(r.select(this._payment,{id:e}))},e.prototype.getInvoices$=function(e){return this.store.pipe(r.select(this._invoices,{id:e}))},e.prototype.getCredits$=function(e){return this.store.pipe(r.select(this._credits,{id:e}))},e.prototype.getGrandTotal$=function(e){return this.store.pipe(r.select(this._grandTotal,{id:e}))},e.prototype.getSubtotal$=function(e){return this.store.pipe(r.select(this._subtotal,{id:e}))},e.prototype.getShippingTotal$=function(e){return this.store.pipe(r.select(this._shipping,{id:e}))},e.prototype.getDiscountTotal$=function(e){return this.store.pipe(r.select(this._discount,{id:e}))},e.prototype.hasDiscount$=function(e){return this.store.pipe(r.select(this._hasDiscount,{id:e}))},e.prototype.getTaxTotal$=function(e){return this.store.pipe(r.select(this._tax,{id:e}))},e.prototype.dispatch=function(e){this.store.dispatch(e)},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.Store}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(r.Store))},token:e,providedIn:"root"}),e}();var C=new n.InjectionToken("DaffPlacedOrderGuardRedirectUrl"),q=function(){function e(e,t,r){this.facade=e,this.router=t,this.redirectUrl=r}return e.prototype.canActivate=function(){var e=this;return this.facade.hasPlacedOrder$.pipe(c.tap(function(t){t||e.router.navigateByUrl(e.redirectUrl)}))},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:w},{type:s.Router},{type:String,decorators:[{type:n.Inject,args:[C]}]}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(w),n.ɵɵinject(s.Router),n.ɵɵinject(C))},token:e,providedIn:"root"}),e}();var G=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(n<3?o(s):n>3?o(t,r,s):o(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},M=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},U=function(){function e(e,t){var r=this;this.actions$=e,this.driver=t,this.get$=this.actions$.pipe(d.ofType(u.OrderLoadAction),c.switchMap(function(e){return r.driver.get(e.orderId,e.cartId).pipe(c.map(function(e){return new p(e)}),c.catchError(function(e){return a.of(new h("Failed to load order"))}))})),this.list$=this.actions$.pipe(d.ofType(u.OrderListAction),c.switchMap(function(e){return r.driver.list(e.payload).pipe(c.map(function(e){return new y(e)}),c.catchError(function(e){return a.of(new g("Failed to list the orders"))}))}))}return e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:d.Actions},{type:void 0,decorators:[{type:n.Inject,args:[l.DaffOrderDriver]}]}]},G([d.Effect(),M("design:type",Object)],e.prototype,"get$",void 0),G([d.Effect(),M("design:type",Object)],e.prototype,"list$",void 0),e}();var B=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[d.EffectsModule.forFeature([U]),r.StoreModule.forFeature("daffOrder",D)],providers:[{provide:C,useValue:"/"}]}]}],e}();e.DAFF_ORDER_STORE_FEATURE_KEY="daffOrder",e.DaffOrderActionTypes=u,e.DaffOrderFacade=w,e.DaffOrderList=O,e.DaffOrderListFailure=g,e.DaffOrderListSuccess=y,e.DaffOrderLoad=f,e.DaffOrderLoadFailure=h,e.DaffOrderLoadSuccess=p,e.DaffOrderStateModule=B,e.DaffPlacedOrderGuard=q,e.DaffPlacedOrderGuardRedirectUrl=C,e.daffGetOrderAdapter=m,e.daffOrderEntitiesInitialState=I,e.daffOrderEntitiesReducer=L,e.daffOrderInitialState=v,e.daffOrderReducer=j,e.daffOrderReducers=D,e.getDaffOrderSelectors=R,e.ɵa=U,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-order-state.umd.min.js.map