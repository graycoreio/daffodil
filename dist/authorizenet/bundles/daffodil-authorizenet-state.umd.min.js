!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store"),require("@angular/core"),require("@ngrx/effects"),require("rxjs/operators"),require("rxjs"),require("@daffodil/cart/state"),require("@daffodil/core"),require("@daffodil/core/state"),require("@daffodil/authorizenet"),require("@daffodil/authorizenet/driver")):"function"==typeof define&&define.amd?define("@daffodil/authorizenet/state",["exports","@ngrx/store","@angular/core","@ngrx/effects","rxjs/operators","rxjs","@daffodil/cart/state","@daffodil/core","@daffodil/core/state","@daffodil/authorizenet","@daffodil/authorizenet/driver"],t):t(((e=e||self).daffodil=e.daffodil||{},e.daffodil.authorizenet=e.daffodil.authorizenet||{},e.daffodil.authorizenet.state={}),e.store,e.ng.core,e.effects,e.rxjs.operators,e.rxjs,e.state,e.core$1,e.state$1,e.daffodil.authorizenet,e.daffodil.authorizenet.driver)}(this,function(e,t,r,a,o,n,c,i,s,f,u){"use strict";var d=function(){return(d=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function p(e,t,r,a){var o,n=arguments.length,c=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(c=(n<3?o(c):n>3?o(t,r,c):o(t,r))||c);return n>3&&c&&Object.defineProperty(t,r,c),c}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,o,n=r.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(e){o={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return c}var h={UpdatePaymentAction:"[Daff-Authorize-Net] Update Payment",UpdatePaymentSuccessAction:"[Daff-Authorize-Net] Update Payment Success",UpdatePaymentFailureAction:"[Daff-Authorize-Net] Update Payment Failure",LoadAcceptJsAction:"[Daff-Authorize-Net] Load Accept Js",LoadAcceptJsSuccessAction:"[Daff-Authorize-Net] Load Accept Js Success",LoadAcceptJsFailureAction:"[Daff-Authorize-Net] Load Accept Js Failure"},A=function(e,t){this.tokenRequest=e,this.address=t,this.type=h.UpdatePaymentAction};var m=function(){this.type=h.UpdatePaymentSuccessAction};var v=function(e){this.payload=e,this.type=h.UpdatePaymentFailureAction};var g=function(){this.type=h.LoadAcceptJsAction};var P=function(){this.type=h.LoadAcceptJsSuccessAction};var S=function(e){this.payload=e,this.type=h.LoadAcceptJsFailureAction};var z,L=function(){var e=t.createFeatureSelector("daffAuthorizenet"),r=t.createSelector(e,function(e){return e.authorizeNet});return{selectAuthorizeNetFeatureState:e,selectAuthorizeNetState:r,selectLoading:t.createSelector(r,function(e){return e.loading}),selectPaymentError:t.createSelector(r,function(e){return e.paymentError}),selectAcceptJsLoadError:t.createSelector(r,function(e){return e.acceptJsLoadError}),selectIsAcceptJsLoaded:t.createSelector(r,function(e){return e.isAcceptLoaded})}},E=function(){return z=z||L()},J=function(){function e(e){this.store=e;var r=E(),a=r.selectIsAcceptJsLoaded,o=r.selectLoading,n=r.selectPaymentError,c=r.selectAcceptJsLoadError;this.isAcceptJsLoaded$=this.store.pipe(t.select(a)),this.loading$=this.store.pipe(t.select(o)),this.paymentError$=this.store.pipe(t.select(n)),this.acceptJsLoadError$=this.store.pipe(t.select(c))}return e.prototype.dispatch=function(e){this.store.dispatch(e)},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.Store}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(t.Store))},token:e,providedIn:"root"}),e}();var b={isAcceptLoaded:!1,paymentError:null,acceptJsLoadError:null,loading:!1};function D(e,t){switch(void 0===e&&(e=b),t.type){case h.UpdatePaymentAction:return d({},e,{loading:!0});case h.UpdatePaymentSuccessAction:return d({},e,{loading:!1,paymentError:null});case h.UpdatePaymentFailureAction:return d({},e,{loading:!1,paymentError:t.payload});case h.LoadAcceptJsSuccessAction:return d({},e,{isAcceptLoaded:!0,acceptJsLoadError:null});case h.LoadAcceptJsFailureAction:return d({},e,{loading:!1,acceptJsLoadError:t.payload});default:return e}}var N={authorizeNet:D},U=function(){function e(e,t,r,f,u){var d=this;this.actions$=e,this.driver=t,this.authorizeNetPaymentId=r,this.errorMatcher=f,this.acceptJsLoadingService=u,this.updatePayment$=this.actions$.pipe(a.ofType(h.UpdatePaymentAction),o.switchMap(function(e){return d.driver.generateToken(e.tokenRequest).pipe(o.map(function(t){return new c.DaffCartPaymentUpdateWithBilling({method:d.authorizeNetPaymentId,payment_info:t},e.address)}),o.catchError(function(e){return n.of(new v(d.errorMatcher(e)))}))})),this.updatePaymentSuccessSubstream$=this.actions$.pipe(s.substream([h.UpdatePaymentAction,c.DaffCartPaymentActionTypes.CartPaymentUpdateWithBillingSuccessAction],c.DaffCartPaymentActionTypes.CartPaymentUpdateWithBillingFailureAction),o.mapTo(new m)),this.updatePaymentFailureSubstream$=this.actions$.pipe(s.substream([h.UpdatePaymentAction,c.DaffCartPaymentActionTypes.CartPaymentUpdateWithBillingFailureAction],c.DaffCartPaymentActionTypes.CartPaymentUpdateWithBillingSuccessAction),o.map(function(e){var t=y(e,2),r=(t[0],t[1]);return new v(d.errorMatcher(r.payload))})),this.loadAcceptJs$=function(e,t){return void 0===e&&(e=10),void 0===t&&(t=10),d.actions$.pipe(a.ofType(h.LoadAcceptJsAction),o.tap(function(e){return d.acceptJsLoadingService.load()}),o.switchMap(function(){return n.of(null).pipe(o.map(function(){return d.acceptJsLoadingService.getAccept()}),i.backoff(e,t),o.mapTo(new P),o.catchError(function(e){return n.of(new S(d.errorMatcher(e)))}))}))}}return e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:a.Actions},{type:void 0,decorators:[{type:r.Inject,args:[u.DaffAuthorizeNetDriver]}]},{type:String,decorators:[{type:r.Inject,args:[u.DaffAuthorizeNetPaymentId]}]},{type:Function,decorators:[{type:r.Inject,args:[f.DAFF_AUTHORIZENET_ERROR_MATCHER]}]},{type:f.DaffAcceptJsLoadingService}]},p([a.Effect(),l("design:type",n.Observable)],e.prototype,"updatePayment$",void 0),p([a.Effect(),l("design:type",n.Observable)],e.prototype,"updatePaymentSuccessSubstream$",void 0),p([a.Effect(),l("design:type",n.Observable)],e.prototype,"updatePaymentFailureSubstream$",void 0),p([a.Effect(),l("design:type",Object)],e.prototype,"loadAcceptJs$",void 0),e}();var F=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[t.StoreModule.forFeature("daffAuthorizenet",N),a.EffectsModule.forFeature([U])]}]}],e}();e.DAFF_AUTHORIZENET_STORE_FEATURE_KEY="daffAuthorizenet",e.DaffAuthorizeNetActionTypes=h,e.DaffAuthorizeNetFacade=J,e.DaffAuthorizeNetStateModule=F,e.DaffAuthorizeNetUpdatePayment=A,e.DaffAuthorizeNetUpdatePaymentFailure=v,e.DaffAuthorizeNetUpdatePaymentSuccess=m,e.DaffLoadAcceptJs=g,e.DaffLoadAcceptJsFailure=S,e.DaffLoadAcceptJsSuccess=P,e.daffAuthorizeNetReducer=D,e.daffAuthorizeNetReducers=N,e.daffAuthorizeNetSelectors=E,e.ɵa=U,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-authorizenet-state.umd.min.js.map