{"version":3,"file":"daffodil-authorizenet-driver-magento.js","sources":["ng://@daffodil/authorizenet/driver/magento/transformers/authorize-net-transformer.ts","ng://@daffodil/authorizenet/driver/magento/authorize-net.service.ts","ng://@daffodil/authorizenet/driver/magento/authorize-net-payment-id.ts","ng://@daffodil/authorizenet/driver/magento/authorize-net.module.ts"],"sourcesContent":["import { DaffAuthorizeNetTokenRequest, AuthorizeNetResponse, AuthorizeNetRequest } from '@daffodil/authorizenet';\nimport { DaffAuthorizeNetConfig } from '@daffodil/authorizenet/driver';\n\nimport { MagentoAuthorizeNetPayment } from '../models/authorize-net-payment';\n\nexport function transformMagentoAuthorizeNetRequest(request: DaffAuthorizeNetTokenRequest, config: DaffAuthorizeNetConfig): AuthorizeNetRequest {\n\treturn {\n\t\tcardData: {\n\t\t\tcardNumber: request.creditCard.cardnumber,\n\t\t\tcardCode: request.creditCard.securitycode,\n\t\t\tmonth: request.creditCard.month,\n\t\t\tyear: request.creditCard.year\n\t\t},\n\t\tauthData: {\n\t\t\tclientKey: config.clientKey,\n\t\t\tapiLoginID: config.apiLoginID\n\t\t}\n\t};\n};\n\nexport function transformMagentoAuthorizeNetResponse(response: AuthorizeNetResponse, ccNumber: string): MagentoAuthorizeNetPayment {\n\treturn {\n\t\tcode: 'authorizenet_acceptjs',\n\t\tauthorizenet_acceptjs: {\n\t\t\tcc_last_4: parseInt(ccNumber.slice(12), 10),\n\t\t\topaque_data_descriptor: 'COMMON.ACCEPT.INAPP.PAYMENT',\n\t\t\topaque_data_value: response.opaqueData.dataValue\n\t\t}\n\t}\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable } from 'rxjs';\n\nimport { DaffAuthorizeNetTokenRequest, AuthorizeNetResponse, DaffAcceptJsLoadingService } from '@daffodil/authorizenet';\nimport { DaffAuthorizeNetService, DaffAuthorizeNetConfigToken, DaffAuthorizeNetConfig, DAFF_AUTHORIZE_NET_ERROR_CODE_MAP } from '@daffodil/authorizenet/driver';\n\nimport { transformMagentoAuthorizeNetRequest, transformMagentoAuthorizeNetResponse } from './transformers/authorize-net-transformer';\nimport { MagentoAuthorizeNetPayment } from './models/authorize-net-payment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffMagentoAuthorizeNetService implements DaffAuthorizeNetService {\n\n\tconstructor(\n    @Inject(DaffAuthorizeNetConfigToken) public config: DaffAuthorizeNetConfig,\n    private acceptJsLoader: DaffAcceptJsLoadingService\n\t) {}\n\n\tgenerateToken(paymentTokenRequest: DaffAuthorizeNetTokenRequest): Observable<MagentoAuthorizeNetPayment> {\n\t\treturn new Observable(observer =>\n\t\t\tthis.acceptJsLoader.getAccept().dispatchData(transformMagentoAuthorizeNetRequest(paymentTokenRequest, this.config), (response: AuthorizeNetResponse) => {\n\t\t\t\tif (response.messages.resultCode === 'Error') {\n          const MappedError = DAFF_AUTHORIZE_NET_ERROR_CODE_MAP[response.messages.message[0].code];\n          const message = response.messages.message[0].code + ': ' + response.messages.message[0].text;\n\n\t\t\t\t\tthrow MappedError ? new MappedError(message) : new Error(message);\n\t\t\t\t} else {\n\t\t\t\t\tobserver.next(transformMagentoAuthorizeNetResponse(response, paymentTokenRequest.creditCard.cardnumber));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","export const MAGENTO_AUTHORIZE_NET_PAYMENT_ID = 'authorizenet_acceptjs';\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DaffAuthorizeNetConfig, DaffAuthorizeNetConfigToken, DaffAuthorizeNetDriver, DaffAuthorizeNetPaymentId } from '@daffodil/authorizenet/driver';\n\nimport { DaffMagentoAuthorizeNetService } from './authorize-net.service';\nimport { MAGENTO_AUTHORIZE_NET_PAYMENT_ID } from './authorize-net-payment-id';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ]\n})\nexport class DaffMagentoAuthorizeNetDriverModule {\n  static forRoot(config: DaffAuthorizeNetConfig): ModuleWithProviders {\n\t\tif(!config.apiLoginID || !config.clientKey) {\n\t\t\tthrow Error('You must provide an apiLoginID and clientKey for Authorize.Net configuration.')\n\t\t}\n\n    return {\n      ngModule: DaffMagentoAuthorizeNetDriverModule,\n      providers: [\n\t\t\t\t{\n\t\t\t\t\tprovide: DaffAuthorizeNetConfigToken,\n\t\t\t\t\tuseValue: config\n\t\t\t\t},\n        {\n          provide: DaffAuthorizeNetDriver,\n\t\t\t\t\tuseExisting: DaffMagentoAuthorizeNetService\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tprovide: DaffAuthorizeNetPaymentId,\n\t\t\t\t\tuseValue: MAGENTO_AUTHORIZE_NET_PAYMENT_ID\n\t\t\t\t}\n      ]\n    };\n  }\n}\n"],"names":[],"mappings":"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"}