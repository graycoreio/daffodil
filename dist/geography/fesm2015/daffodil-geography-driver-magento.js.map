{"version":3,"file":"daffodil-geography-driver-magento.js","sources":["ng://@daffodil/geography/driver/magento/transforms/responses/subdivision.service.ts","ng://@daffodil/geography/driver/magento/transforms/responses/country.service.ts","ng://@daffodil/geography/driver/magento/queries/fragments/country.ts","ng://@daffodil/geography/driver/magento/queries/fragments/region.ts","ng://@daffodil/geography/driver/magento/queries/get-countries.ts","ng://@daffodil/geography/driver/magento/queries/get-country.ts","ng://@daffodil/geography/driver/magento/validators/get-countries.ts","ng://@daffodil/geography/driver/magento/errors/codes.ts","ng://@daffodil/geography/driver/magento/errors/map.ts","ng://@daffodil/geography/driver/magento/errors/transform.ts","ng://@daffodil/geography/driver/magento/geography.service.ts","ng://@daffodil/geography/driver/magento/geography-driver.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { DaffSubdivision } from '@daffodil/geography';\n\nimport { MagentoRegion } from '../../models/responses/region';\n\n/**\n * Transforms magento carts into an object usable by daffodil.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffMagentoSubdivisionTransformer {\n  /**\n   * Transforms the MagentoRegion from the magento region query into a DaffSubdivision.\n   */\n  transform(region: MagentoRegion): DaffSubdivision {\n    return region ? {\n      ...{magento_region: region},\n\n      id: String(region.id),\n      name: region.name,\n      iso_3166_2: region.code\n    } : null\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { DaffCountry } from '@daffodil/geography';\n\nimport { DaffMagentoSubdivisionTransformer } from './subdivision.service';\nimport { MagentoCountry } from '../../models/responses/country';\n\n/**\n * Transforms magento carts into an object usable by daffodil.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffMagentoCountryTransformer {\n  constructor(public subdivisionTransformer: DaffMagentoSubdivisionTransformer) {}\n\n  private transformSubdivisions(regions: MagentoCountry['available_regions']): DaffCountry['subdivisions'] {\n    return regions.map(region => this.subdivisionTransformer.transform(region))\n  }\n\n  /**\n   * Transforms the MagentoCountry from the magento country query into a DaffCountry.\n   */\n  transform(country: MagentoCountry): DaffCountry {\n    return country ? {\n      ...{magento_country: country},\n\n      subdivisions: this.transformSubdivisions(country.available_regions || []),\n\n      id: country.id,\n      name: country.full_name_locale,\n      name_en: country.full_name_english,\n      alpha2: country.two_letter_abbreviation,\n      alpha3: country.three_letter_abbreviation,\n    } : null\n  }\n}\n","import gql from 'graphql-tag';\n\nexport const countryFragment = gql`\n  fragment country on Country {\n    id\n    full_name_english\n    full_name_locale\n    three_letter_abbreviation\n    two_letter_abbreviation\n  }\n`;\n","import gql from 'graphql-tag';\n\nexport const regionFragment = gql`\n  fragment region on Region {\n    code\n    id\n    name\n  }\n`;\n","import gql from 'graphql-tag';\n\nimport { countryFragment } from './fragments/public_api';\n\nexport const getCountries = gql`\n  query GetCountries {\n    countries {\n      ...country\n    }\n  }\n  ${countryFragment}\n`;\n","import gql from 'graphql-tag';\n\nimport { countryFragment, regionFragment } from './fragments/public_api';\n\nexport const getCountry = gql`\n  query GetCountry($countryId: String!) {\n    country(id: $countryId) {\n      ...country\n      available_regions {\n        ...region\n      }\n    }\n  }\n  ${countryFragment}\n  ${regionFragment}\n`;\n","import { ApolloQueryResult } from 'apollo-client';\n\nimport { DaffGeographyInvalidAPIResponseError } from '@daffodil/geography/driver';\n\nimport { MagentoGetCountriesResponse } from '../queries/public_api';\n\nexport const validateGetCountriesResponse = (response: ApolloQueryResult<MagentoGetCountriesResponse>) => {\n  if (response.data.countries) {\n    return response\n  } else {\n    throw new DaffGeographyInvalidAPIResponseError('Get countries response does not contain a valid list of countries.')\n  }\n}\n","export enum MagentoGeographyGraphQlErrorCode {\n\tCOUNTRY_NOT_FOUND = 'graphql-no-such-entity',\n}\n","import { DaffErrorCodeMap } from '@daffodil/core';\nimport { DaffCountryNotFoundError } from '@daffodil/geography/driver';\n\nimport { MagentoGeographyGraphQlErrorCode } from './codes';\n\nexport const DaffGeographyMagentoErrorMap: DaffErrorCodeMap = {\n\t[MagentoGeographyGraphQlErrorCode.COUNTRY_NOT_FOUND]: DaffCountryNotFoundError,\n};\n","import { daffTransformMagentoError } from '@daffodil/driver/magento';\n\nimport { DaffGeographyMagentoErrorMap } from './map';\n\nexport function transformMagentoGeographyError(error: any) {\n  return daffTransformMagentoError(error, DaffGeographyMagentoErrorMap)\n}\n","import { Injectable } from '@angular/core';\nimport { Apollo } from 'apollo-angular';\n\nimport { Observable, throwError } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { DaffCountry } from '@daffodil/geography';\nimport { DaffGeographyServiceInterface } from '@daffodil/geography/driver';\n\nimport { DaffMagentoCountryTransformer } from './transforms/responses/country.service';\nimport { getCountries, MagentoGetCountriesResponse } from './queries/public_api';\nimport { getCountry } from './queries/get-country';\nimport { MagentoGetCountryResponse } from './queries/responses/get-country';\nimport { validateGetCountriesResponse } from './validators/public_api';\nimport { transformMagentoGeographyError } from './errors/transform';\n\n/**\n * A service for making Magento GraphQL queries for carts.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffGeographyMagentoService implements DaffGeographyServiceInterface<DaffCountry> {\n  constructor(\n    private apollo: Apollo,\n    public countryTransformer: DaffMagentoCountryTransformer,\n  ) {}\n\n  list(): Observable<DaffCountry[]> {\n    return this.apollo.query<MagentoGetCountriesResponse>({\n      query: getCountries,\n    }).pipe(\n      map(validateGetCountriesResponse),\n      map(result => result.data.countries.map(country => this.countryTransformer.transform(country))),\n      catchError(err => throwError(transformMagentoGeographyError(err)))\n    );\n  }\n\n  get(countryId: DaffCountry['id']): Observable<DaffCountry> {\n    return this.apollo.query<MagentoGetCountryResponse>({\n      query: getCountry,\n      variables: {\n        countryId\n      }\n    }).pipe(\n      map(result => this.countryTransformer.transform(result.data.country)),\n      catchError(err => throwError(transformMagentoGeographyError(err)))\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DaffGeographyDriver } from '@daffodil/geography/driver'\n\nimport { DaffGeographyMagentoService } from './geography.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n  ]\n})\nexport class DaffGeographyMagentoDriverModule {\n  static forRoot(): ModuleWithProviders<DaffGeographyMagentoDriverModule> {\n    return {\n      ngModule: DaffGeographyMagentoDriverModule,\n      providers: [\n        {\n          provide: DaffGeographyDriver,\n          useExisting: DaffGeographyMagentoService\n        }\n      ]\n    };\n  }\n}\n"],"names":[],"mappings":"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"}