!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/store"),require("@ngrx/entity"),require("@angular/core"),require("@ngrx/effects"),require("rxjs/operators"),require("rxjs"),require("@daffodil/geography/driver")):"function"==typeof define&&define.amd?define("@daffodil/geography/state",["exports","@ngrx/store","@ngrx/entity","@angular/core","@ngrx/effects","rxjs/operators","rxjs","@daffodil/geography/driver"],e):e(((t=t||self).daffodil=t.daffodil||{},t.daffodil.geography=t.daffodil.geography||{},t.daffodil.geography.state={}),t.store,t.entity,t.ng.core,t.effects,t.rxjs.operators,t.rxjs,t.daffodil.geography.driver)}(this,function(t,e,r,o,n,i,s,a){"use strict";var c={loading:!1,errors:[]},u={CountryLoadAction:"[DaffGeography] Country Load Action",CountryLoadSuccessAction:"[DaffGeography] Country Load Success Action",CountryLoadFailureAction:"[DaffGeography] Country Load Failure Action",CountryListAction:"[DaffGeography] Country List Action",CountryListSuccessAction:"[DaffGeography] Country List Success Action",CountryListFailureAction:"[DaffGeography] Country List Failure Action"},f=function(t){this.payload=t,this.type=u.CountryLoadAction};var l=function(t){this.payload=t,this.type=u.CountryLoadSuccessAction};var y=function(t){this.payload=t,this.type=u.CountryLoadFailureAction};var d=function(){this.type=u.CountryListAction};var p=function(t){this.payload=t,this.type=u.CountryListSuccessAction};var h=function(t){this.payload=t,this.type=u.CountryListFailureAction};var g=this&&this.__assign||function(){return(g=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},v=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},C=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v(arguments[e]));return t};function S(t,e){switch(void 0===t&&(t=c),e.type){case u.CountryLoadAction:case u.CountryListAction:return g({},t,{loading:!0});case u.CountryLoadSuccessAction:case u.CountryListSuccessAction:return g({},t,{errors:[],loading:!1});case u.CountryLoadFailureAction:case u.CountryListFailureAction:return g({},t,{errors:C(t.errors,[e.payload]),loading:!1});default:return t}}var L,A=function(){return L=L||r.createEntityAdapter()},b=A().getInitialState(),j=this&&this.__assign||function(){return(j=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function F(t,e){void 0===t&&(t=b);var r=A();switch(e.type){case u.CountryLoadSuccessAction:return r.upsertOne(j({},e.payload,{loaded:!0}),t);case u.CountryListSuccessAction:return r.upsertMany(e.payload.map(function(e){return j({},e,{loaded:t.entities[e.id]&&t.entities[e.id].loaded||!1,subdivisions:0===e.subdivisions.length&&t.entities[e.id]&&t.entities[e.id].subdivisions.length>0?t.entities[e.id].subdivisions:e.subdivisions})}),t);default:return t}}var G={geography:S,countries:F};var _=function(){var t;return function(){return t=t||{selectGeographyFeatureState:e.createFeatureSelector("daffGeography")}}}();var D=function(){var t=_().selectGeographyFeatureState,r=e.createSelector(t,function(t){return t.countries}),o=A().getSelectors(r),n=o.selectIds,i=o.selectEntities,s=o.selectAll,a=o.selectTotal,c=e.createSelector(i,function(t,e){return t[e.id]}),u=e.createSelector(i,function(t,e){var r=c.projector(t,{id:e.id});return r?r.subdivisions:[]}),f=e.createSelector(i,function(t,e){var r=c.projector(t,{id:e.id});return r&&r.loaded});return{selectCountryEntitiesState:r,selectCountryIds:n,selectCountryEntities:i,selectAllCountries:s,selectCountryTotal:a,selectCountry:c,selectCountrySubdivisions:u,selectIsCountryFullyLoaded:f}},E=function(){var t;return function(){return t=t||D()}}();var I=function(){var t=_().selectGeographyFeatureState,r=e.createSelector(t,function(t){return t.geography});return{selectGeographyState:r,selectGeographyLoading:e.createSelector(r,function(t){return t.loading}),selectGeographyErrors:e.createSelector(r,function(t){return t.errors})}},O=function(){var t;return function(){return t=t||I()}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var w=function(){var t;return function(){return t=t||x({},O(),E(),_())}}(),m=function(){function t(t){this.store=t;var r=w(),o=r.selectCountryIds,n=r.selectCountryEntities,i=r.selectAllCountries,s=r.selectCountryTotal,a=r.selectGeographyLoading,c=r.selectGeographyErrors,u=r.selectCountry,f=r.selectCountrySubdivisions,l=r.selectIsCountryFullyLoaded;this._selectCountry=u,this._selectCountrySubdivisions=f,this._selectIsCountryFullyLoaded=l,this.loading$=this.store.pipe(e.select(a)),this.errors$=this.store.pipe(e.select(c)),this.countries$=this.store.pipe(e.select(i)),this.countryIds$=this.store.pipe(e.select(o)),this.countryCount$=this.store.pipe(e.select(s)),this.countryEntities$=this.store.pipe(e.select(n))}return t.prototype.getCountry=function(t){return this.store.pipe(e.select(this._selectCountry,{id:t}))},t.prototype.getCountrySubdivisions=function(t){return this.store.pipe(e.select(this._selectCountrySubdivisions,{id:t}))},t.prototype.isCountryFullyLoaded=function(t){return this.store.pipe(e.select(this._selectIsCountryFullyLoaded,{id:t}))},t.prototype.dispatch=function(t){this.store.dispatch(t)},t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:e.Store}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(e.Store))},token:t,providedIn:"root"}),t}();var $=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,r,s):n(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},R=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},P=function(){function t(t,e){var r=this;this.actions$=t,this.driver=e,this.get$=this.actions$.pipe(n.ofType(u.CountryLoadAction),i.switchMap(function(t){return r.driver.get(t.payload).pipe(i.map(function(t){return new l(t)}),i.catchError(function(t){return s.of(new y("Failed to load country"))}))})),this.list$=this.actions$.pipe(n.ofType(u.CountryListAction),i.switchMap(function(t){return r.driver.list().pipe(i.map(function(t){return new p(t)}),i.catchError(function(t){return s.of(new h("Failed to list the countries"))}))}))}return t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:n.Actions},{type:void 0,decorators:[{type:o.Inject,args:[a.DaffGeographyDriver]}]}]},$([n.Effect(),R("design:type",Object)],t.prototype,"get$",void 0),$([n.Effect(),R("design:type",Object)],t.prototype,"list$",void 0),t}();var M=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.StoreModule.forFeature("daffGeography",G),n.EffectsModule.forFeature([P])]}]}],t}();t.DAFF_GEOGRAPHY_STORE_FEATURE_KEY="daffGeography",t.DaffCountryList=d,t.DaffCountryListFailure=h,t.DaffCountryListSuccess=p,t.DaffCountryLoad=f,t.DaffCountryLoadFailure=y,t.DaffCountryLoadSuccess=l,t.DaffGeographyActionTypes=u,t.DaffGeographyFacade=m,t.DaffGeographyStateModule=M,t.daffCountryEntitiesInitialState=b,t.daffCountryEntitiesReducer=F,t.daffGeographyInitialState=c,t.daffGeographyReducer=S,t.daffGeographyReducers=G,t.getCountryAdapter=A,t.getDaffGeographySelectors=w,t.ɵa=P,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-geography-state.umd.min.js.map