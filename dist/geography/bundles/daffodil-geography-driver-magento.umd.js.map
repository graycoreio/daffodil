{"version":3,"file":"daffodil-geography-driver-magento.umd.js","sources":["ng://@daffodil/geography/driver/magento/transforms/responses/subdivision.service.ts","ng://@daffodil/geography/driver/magento/transforms/responses/country.service.ts","ng://@daffodil/geography/driver/magento/queries/fragments/country.ts","ng://@daffodil/geography/driver/magento/queries/fragments/region.ts","ng://@daffodil/geography/driver/magento/queries/get-countries.ts","ng://@daffodil/geography/driver/magento/queries/get-country.ts","ng://@daffodil/geography/driver/magento/validators/get-countries.ts","ng://@daffodil/geography/driver/magento/errors/codes.ts","ng://@daffodil/geography/driver/magento/errors/map.ts","ng://@daffodil/geography/driver/magento/errors/transform.ts","ng://@daffodil/geography/driver/magento/geography.service.ts","ng://@daffodil/geography/driver/magento/geography-driver.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { DaffSubdivision } from '@daffodil/geography';\n\nimport { MagentoRegion } from '../../models/responses/region';\n\n/**\n * Transforms magento carts into an object usable by daffodil.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffMagentoSubdivisionTransformer {\n  /**\n   * Transforms the MagentoRegion from the magento region query into a DaffSubdivision.\n   */\n  transform(region: MagentoRegion): DaffSubdivision {\n    return region ? {\n      ...{magento_region: region},\n\n      id: String(region.id),\n      name: region.name,\n      iso_3166_2: region.code\n    } : null\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { DaffCountry } from '@daffodil/geography';\n\nimport { DaffMagentoSubdivisionTransformer } from './subdivision.service';\nimport { MagentoCountry } from '../../models/responses/country';\n\n/**\n * Transforms magento carts into an object usable by daffodil.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffMagentoCountryTransformer {\n  constructor(public subdivisionTransformer: DaffMagentoSubdivisionTransformer) {}\n\n  private transformSubdivisions(regions: MagentoCountry['available_regions']): DaffCountry['subdivisions'] {\n    return regions.map(region => this.subdivisionTransformer.transform(region))\n  }\n\n  /**\n   * Transforms the MagentoCountry from the magento country query into a DaffCountry.\n   */\n  transform(country: MagentoCountry): DaffCountry {\n    return country ? {\n      ...{magento_country: country},\n\n      subdivisions: this.transformSubdivisions(country.available_regions || []),\n\n      id: country.id,\n      name: country.full_name_locale,\n      name_en: country.full_name_english,\n      alpha2: country.two_letter_abbreviation,\n      alpha3: country.three_letter_abbreviation,\n    } : null\n  }\n}\n","import gql from 'graphql-tag';\n\nexport const countryFragment = gql`\n  fragment country on Country {\n    id\n    full_name_english\n    full_name_locale\n    three_letter_abbreviation\n    two_letter_abbreviation\n  }\n`;\n","import gql from 'graphql-tag';\n\nexport const regionFragment = gql`\n  fragment region on Region {\n    code\n    id\n    name\n  }\n`;\n","import gql from 'graphql-tag';\n\nimport { countryFragment } from './fragments/public_api';\n\nexport const getCountries = gql`\n  query GetCountries {\n    countries {\n      ...country\n    }\n  }\n  ${countryFragment}\n`;\n","import gql from 'graphql-tag';\n\nimport { countryFragment, regionFragment } from './fragments/public_api';\n\nexport const getCountry = gql`\n  query GetCountry($countryId: String!) {\n    country(id: $countryId) {\n      ...country\n      available_regions {\n        ...region\n      }\n    }\n  }\n  ${countryFragment}\n  ${regionFragment}\n`;\n","import { ApolloQueryResult } from 'apollo-client';\n\nimport { DaffGeographyInvalidAPIResponseError } from '@daffodil/geography/driver';\n\nimport { MagentoGetCountriesResponse } from '../queries/public_api';\n\nexport const validateGetCountriesResponse = (response: ApolloQueryResult<MagentoGetCountriesResponse>) => {\n  if (response.data.countries) {\n    return response\n  } else {\n    throw new DaffGeographyInvalidAPIResponseError('Get countries response does not contain a valid list of countries.')\n  }\n}\n","export enum MagentoGeographyGraphQlErrorCode {\n\tCOUNTRY_NOT_FOUND = 'graphql-no-such-entity',\n}\n","import { DaffErrorCodeMap } from '@daffodil/core';\nimport { DaffCountryNotFoundError } from '@daffodil/geography/driver';\n\nimport { MagentoGeographyGraphQlErrorCode } from './codes';\n\nexport const DaffGeographyMagentoErrorMap: DaffErrorCodeMap = {\n\t[MagentoGeographyGraphQlErrorCode.COUNTRY_NOT_FOUND]: DaffCountryNotFoundError,\n};\n","import { daffTransformMagentoError } from '@daffodil/driver/magento';\n\nimport { DaffGeographyMagentoErrorMap } from './map';\n\nexport function transformMagentoGeographyError(error: any) {\n  return daffTransformMagentoError(error, DaffGeographyMagentoErrorMap)\n}\n","import { Injectable } from '@angular/core';\nimport { Apollo } from 'apollo-angular';\n\nimport { Observable, throwError } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { DaffCountry } from '@daffodil/geography';\nimport { DaffGeographyServiceInterface } from '@daffodil/geography/driver';\n\nimport { DaffMagentoCountryTransformer } from './transforms/responses/country.service';\nimport { getCountries, MagentoGetCountriesResponse } from './queries/public_api';\nimport { getCountry } from './queries/get-country';\nimport { MagentoGetCountryResponse } from './queries/responses/get-country';\nimport { validateGetCountriesResponse } from './validators/public_api';\nimport { transformMagentoGeographyError } from './errors/transform';\n\n/**\n * A service for making Magento GraphQL queries for carts.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DaffGeographyMagentoService implements DaffGeographyServiceInterface<DaffCountry> {\n  constructor(\n    private apollo: Apollo,\n    public countryTransformer: DaffMagentoCountryTransformer,\n  ) {}\n\n  list(): Observable<DaffCountry[]> {\n    return this.apollo.query<MagentoGetCountriesResponse>({\n      query: getCountries,\n    }).pipe(\n      map(validateGetCountriesResponse),\n      map(result => result.data.countries.map(country => this.countryTransformer.transform(country))),\n      catchError(err => throwError(transformMagentoGeographyError(err)))\n    );\n  }\n\n  get(countryId: DaffCountry['id']): Observable<DaffCountry> {\n    return this.apollo.query<MagentoGetCountryResponse>({\n      query: getCountry,\n      variables: {\n        countryId\n      }\n    }).pipe(\n      map(result => this.countryTransformer.transform(result.data.country)),\n      catchError(err => throwError(transformMagentoGeographyError(err)))\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DaffGeographyDriver } from '@daffodil/geography/driver'\n\nimport { DaffGeographyMagentoService } from './geography.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n  ]\n})\nexport class DaffGeographyMagentoDriverModule {\n  static forRoot(): ModuleWithProviders<DaffGeographyMagentoDriverModule> {\n    return {\n      ngModule: DaffGeographyMagentoDriverModule,\n      providers: [\n        {\n          provide: DaffGeographyDriver,\n          useExisting: DaffGeographyMagentoService\n        }\n      ]\n    };\n  }\n}\n"],"names":["Injectable","DaffGeographyInvalidAPIResponseError","DaffCountryNotFoundError","daffTransformMagentoError","map","catchError","throwError","Apollo","DaffGeographyDriver","NgModule","CommonModule"],"mappings":"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"}