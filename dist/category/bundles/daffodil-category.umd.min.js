!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@ngrx/entity"),require("@angular/core"),require("@ngrx/store"),require("@angular/common"),require("@ngrx/effects"),require("rxjs/operators"),require("rxjs"),require("@daffodil/product"),require("apollo-angular"),require("graphql-tag")):"function"==typeof define&&define.amd?define("@daffodil/category",["exports","@ngrx/entity","@angular/core","@ngrx/store","@angular/common","@ngrx/effects","rxjs/operators","rxjs","@daffodil/product","apollo-angular","graphql-tag"],e):e(((t=t||self).daffodil=t.daffodil||{},t.daffodil.category={}),t.entity,t.ng.core,t.store,t.ng.common,t.effects,t.rxjs.operators,t.rxjs,t.product,t.apolloAngular,t.gql)}(this,function(t,e,r,o,n,a,i,c,s,u,g){"use strict";g=g&&g.hasOwnProperty("default")?g.default:g;var l=function(){return(l=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function p(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(i=(a<3?n(i):a>3?n(e,r,i):n(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function f(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function y(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t}function C(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var h={CategoryLoadAction:"[Daff-Category] Category Load Action",CategoryLoadSuccessAction:"[Daff-Category] Category Load Success Action",CategoryLoadFailureAction:"[Daff-Category] Category Load Failure Action",CategoryPageLoadAction:"[Daff-Category] Category Page Load Action",CategoryPageLoadSuccessAction:"[Daff-Category] Category Page Load Success Action",CategoryPageLoadFailureAction:"[Daff-Category] Category Page Load Failure Action",ChangeCategoryPageSizeAction:"[Daff-Category] Change Category Page Size Action",ChangeCategoryCurrentPageAction:"[Daff-Category] Change Category Current Page Action",ChangeCategorySortingOptionAction:"[Daff-Category] Change Category Sorting Option Action",ChangeCategoryFiltersAction:"[Daff-Category] Change Category Filters Action",ToggleCategoryFilterAction:"[Daff-Category] Toggle Category Filter Action"},S=function(t){this.request=t,this.type=h.CategoryLoadAction};var m=function(t){this.response=t,this.type=h.CategoryLoadSuccessAction};var v=function(t){this.errorMessage=t,this.type=h.CategoryLoadFailureAction};var P=function(t){this.request=t,this.type=h.CategoryPageLoadAction};var _=function(t){this.response=t,this.type=h.CategoryPageLoadSuccessAction};var b=function(t){this.errorMessage=t,this.type=h.CategoryPageLoadFailureAction};var A=function(t){this.pageSize=t,this.type=h.ChangeCategoryPageSizeAction};var I=function(t){this.currentPage=t,this.type=h.ChangeCategoryCurrentPageAction};var L=function(t){this.sort=t,this.type=h.ChangeCategorySortingOptionAction};var D=function(t){this.filters=t,this.type=h.ChangeCategoryFiltersAction};var $=function(t){this.filter=t,this.type=h.ToggleCategoryFilterAction};var q={Match:"match",Equal:"equal",Range:"range"};function F(t,e){return e.filter(function(e){return e.name===t}).shift()}function j(t,e){return e&&!!e.find(function(e){return e.name===t.name})}function M(t,e){return e.map(function(e){return e.name===t.name&&e.value.push(t.value),e})}function T(t,e){return j(t,e)?M(t,e):function(t,e){return e.concat([{name:t.name,value:[t.value],type:q.Equal}])}(t,e)}function w(t,e){return j(t,e)?M(t,e):function(t,e){return e.concat([{name:t.name,value:[t.value],type:q.Range}])}(t,e)}function E(t,e){return function(t,e){switch(t.type){case q.Equal:case q.Range:return function(t,e){var r=F(t.name,e);return!!r&&!!r.value.filter(function(e){return e===t.value}).length}(t,e);default:return function(t,e){return!!F(t.name,e)}(t,e)}}(t,e)?function(t,e){switch(t.type){case q.Equal:case q.Range:return function(t,e){return e.map(function(e){return e.name===t.name&&(e.value=e.value.filter(function(e){return e!==t.value})),e}).filter(function(t){return t.type===q.Match||0!==t.value.length})}(t,e);default:return function(t,e){return e.filter(function(e){return e.name!==t.name})}(t,e)}}(t,e):function(t,e){switch(t.type){case q.Equal:return T(t,e);case q.Range:return w(t,e);default:return function(t,e){return e.concat([{name:t.name,value:t.value,type:q.Match}])}(t,e)}}(t,e)}var R={categoryPageConfigurationState:{id:null,filter_requests:[],applied_sort_option:null,applied_sort_direction:null,current_page:null,page_size:null,total_pages:null,filters:[],sort_options:[],total_products:null,product_ids:[]},categoryLoading:!1,productsLoading:!1,errors:[]};function z(t,e){switch(void 0===t&&(t=R),e.type){case h.CategoryLoadAction:return l({},t,{categoryLoading:!0,productsLoading:!0});case h.CategoryPageLoadAction:return l({},t,{categoryLoading:!0,productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,e.request)});case h.ChangeCategoryPageSizeAction:return l({},t,{productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{page_size:e.pageSize})});case h.ChangeCategoryCurrentPageAction:return l({},t,{productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{current_page:e.currentPage})});case h.ChangeCategorySortingOptionAction:return l({},t,{productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{applied_sort_option:e.sort.option,applied_sort_direction:e.sort.direction})});case h.ChangeCategoryFiltersAction:return l({},t,{productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{filter_requests:e.filters})});case h.ToggleCategoryFilterAction:return l({},t,{productsLoading:!0,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{filter_requests:E(e.filter,t.categoryPageConfigurationState.filter_requests)})});case h.CategoryLoadSuccessAction:case h.CategoryPageLoadSuccessAction:return l({},t,{categoryLoading:!1,productsLoading:!1,categoryPageConfigurationState:l({},t.categoryPageConfigurationState,{id:e.response.categoryPageConfigurationState.id,current_page:e.response.categoryPageConfigurationState.current_page,page_size:e.response.categoryPageConfigurationState.page_size,filters:e.response.categoryPageConfigurationState.filters,sort_options:e.response.categoryPageConfigurationState.sort_options,total_pages:e.response.categoryPageConfigurationState.total_pages,total_products:e.response.categoryPageConfigurationState.total_products,product_ids:e.response.categoryPageConfigurationState.product_ids})});case h.CategoryLoadFailureAction:case h.CategoryPageLoadFailureAction:return l({},t,{categoryLoading:!1,productsLoading:!1,errors:[e.errorMessage]});default:return t}}function O(){return e.createEntityAdapter()}function x(t,e){switch(void 0===t&&(t=O().getInitialState()),e.type){case h.CategoryLoadSuccessAction:case h.CategoryPageLoadSuccessAction:return O().upsertOne(l({id:e.response.category.id},e.response.category),t);default:return t}}var G={category:z,categoryEntities:x},k=new r.InjectionToken("DaffCategoryDriver"),V="-";function B(t){t&&t.forEach(function(e,r){if(e.type===q.Range&&2!==e.value[0].split(V).length)throw new Error("Category range filter is in an invalid format. Should be **-**");for(var o=r+1;o<t.length;o++)if(t[r].name===t[o].name)throw new Error("More than one category filter of the same name exists. These should be combined into a single filter action with multiple values.")})}var Q=function(){function t(t,e){var r=this;this.actions$=t,this.driver=e,this.loadCategory$=this.actions$.pipe(a.ofType(h.CategoryLoadAction),i.switchMap(function(t){return B(t.request.filter_requests),r.driver.get(t.request).pipe(i.switchMap(function(t){return c.of(new s.DaffProductGridLoadSuccess(t.products),new m(t))}),i.catchError(function(t){return c.of(new v("Failed to load the category"))}))}))}return t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:a.Actions},{type:void 0,decorators:[{type:r.Inject,args:[k]}]}]},p([a.Effect(),f("design:type",c.Observable)],t.prototype,"loadCategory$",void 0),t}();var N=new r.InjectionToken("DaffDefaultCategoryPageSize"),K=function(){function t(t,e,r,o){this.platformId=t,this.defaultCategoryPageSize=e,this.store=r,this.dispatcher=o}return t.prototype.resolve=function(t){return this.store.dispatch(new P({id:t.paramMap.get("id"),page_size:this.defaultCategoryPageSize})),n.isPlatformBrowser(this.platformId)?c.of(!0):this.dispatcher.pipe(a.ofType(h.CategoryPageLoadSuccessAction,h.CategoryPageLoadFailureAction),i.mapTo(!0),i.take(1))},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:String,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]},{type:Number,decorators:[{type:r.Inject,args:[N]}]},{type:o.Store},{type:o.ActionsSubject}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(r.PLATFORM_ID),r.ɵɵinject(N),r.ɵɵinject(o.Store),r.ɵɵinject(o.ActionsSubject))},token:t,providedIn:"root"}),t}();var U,H=function(){return U=U||{selectCategoryFeatureState:o.createFeatureSelector("category")}};function J(t,e){switch(e.type){case q.Equal:case q.Range:return function(t,e){return t.filter(function(t){return e.value.indexOf(t.value)>-1}).map(function(t){return{value:t.value,label:t.label}})}(t,e);case q.Match:return function(t,e){return t.filter(function(t){return e.value===t.value}).map(function(t){return{value:t.value,label:t.label}})}(t,e)}}var W=function(){var t=H().selectCategoryFeatureState,e=o.createSelector(t,function(t){return t.category}),r=o.createSelector(e,function(t){return t.categoryPageConfigurationState}),n=o.createSelector(r,function(t){return t.current_page}),a=o.createSelector(r,function(t){return t.total_pages}),i=o.createSelector(r,function(t){return t.page_size}),c=o.createSelector(r,function(t){return t.filters}),s=o.createSelector(r,function(t){return t.sort_options}),u=o.createSelector(r,function(t){return t.product_ids}),g=o.createSelector(u,function(t){return!t.length}),l=o.createSelector(r,function(t){return t.total_products}),p=o.createSelector(r,function(t){return t.filter_requests});return{selectCategoryState:e,selectCategoryPageConfigurationState:r,selectCategoryCurrentPage:n,selectCategoryTotalPages:a,selectCategoryPageSize:i,selectCategoryFilters:c,selectCategorySortOptions:s,selectCategoryPageProductIds:u,selectIsCategoryPageEmpty:g,selectCategoryPageTotalProducts:l,selectCategoryPageFilterRequests:p,selectCategoryPageAppliedFilters:o.createSelector(p,c,function(t,e){return e.length?t.map(function(t){return e.filter(function(e){return e.name===t.name}).map(function(e){return function(t,e){return{name:e.name,type:e.type,label:t.label,options:J(t.options,e)}}(e,t)}).shift()}):[]}),selectCategoryPageAppliedSortOption:o.createSelector(r,function(t){return t.applied_sort_option}),selectCategoryPageAppliedSortDirection:o.createSelector(r,function(t){return t.applied_sort_direction}),selectSelectedCategoryId:o.createSelector(r,function(t){return t.id}),selectCategoryLoading:o.createSelector(e,function(t){return t.categoryLoading}),selectCategoryProductsLoading:o.createSelector(e,function(t){return t.productsLoading}),selectCategoryErrors:o.createSelector(e,function(t){return t.errors})}},X=function(){var t;return function(){return t=t||W()}}();var Y=function(){var t=O().getSelectors(),e=H().selectCategoryFeatureState,r=o.createSelector(e,function(t){return t.categoryEntities});return{selectCategoryEntitiesState:r,selectCategoryIds:o.createSelector(r,t.selectIds),selectCategoryEntities:o.createSelector(r,t.selectEntities),selectAllCategories:o.createSelector(r,t.selectAll),selectCategoryTotal:o.createSelector(r,t.selectTotal)}},Z=function(){var t;return function(){return t=t||Y()}}();var tt=function(){var t=s.getDaffProductSelectors(),e=t.selectProductEntities,r=t.selectAllProducts,n=Z().selectCategoryEntities,a=X(),i=a.selectSelectedCategoryId,c=a.selectCategoryPageProductIds,u=o.createSelector(n,i,function(t,e){return t[e]}),g=o.createSelector(c,e,function(t,e){return t.map(function(t){return e[t]}).filter(function(t){return null!=t})}),p=o.createSelector(n,function(t,e){return t[e.id]}),f=o.createSelector(n,r,function(t,e,r){return t[r.id]&&t[r.id].product_ids?e.filter(function(e){return t[r.id].product_ids.indexOf(e.id)>=0}):null}),y=o.createSelector(n,r,function(t,e,r){return f.projector(t,e,{id:r.id})?f.projector(t,e,{id:r.id}).length:null});return l({},H(),Z(),X(),{selectSelectedCategory:u,selectCategoryPageProducts:g,selectCategory:p,selectProductsByCategory:f,selectTotalProductsByCategory:y})},et=function(){var t;return function(){return t=t||tt()}}(),rt=function(){function t(t,e,r){var n=this;this.actions$=t,this.driver=e,this.store=r,this.categorySelectors=et(),this.loadCategoryPage$=this.actions$.pipe(a.ofType(h.CategoryPageLoadAction),i.switchMap(function(t){return B(t.request.filter_requests),n.processCategoryGetRequest(t.request)})),this.changeCategoryPageSize$=this.actions$.pipe(a.ofType(h.ChangeCategoryPageSizeAction),i.withLatestFrom(this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState))),i.switchMap(function(t){var e=y(t,2),r=e[0],o=e[1];return n.processCategoryGetRequest(l({},o,{page_size:r.pageSize}))})),this.changeCategoryCurrentPage$=this.actions$.pipe(a.ofType(h.ChangeCategoryCurrentPageAction),i.withLatestFrom(this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState))),i.switchMap(function(t){var e=y(t,2),r=e[0],o=e[1];return n.processCategoryGetRequest(l({},o,{current_page:r.currentPage}))})),this.changeCategoryFilters$=this.actions$.pipe(a.ofType(h.ChangeCategoryFiltersAction),i.withLatestFrom(this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState))),i.switchMap(function(t){var e=y(t,2),r=e[0],o=e[1];return B(r.filters),n.processCategoryGetRequest(l({},o,{filter_requests:r.filters}))})),this.toggleCategoryFilter$=this.actions$.pipe(a.ofType(h.ToggleCategoryFilterAction),i.withLatestFrom(this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState))),i.switchMap(function(t){var e=y(t,2),r=(e[0],e[1]);return B(r.filter_requests),n.processCategoryGetRequest(l({},r))})),this.changeCategorySort$=this.actions$.pipe(a.ofType(h.ChangeCategorySortingOptionAction),i.withLatestFrom(this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState))),i.switchMap(function(t){var e=y(t,2),r=e[0],o=e[1];return n.processCategoryGetRequest(l({},o,{applied_sort_option:r.sort.option,applied_sort_direction:r.sort.direction}))}))}return t.prototype.processCategoryGetRequest=function(t){return this.driver.get(t).pipe(i.switchMap(function(t){return[new s.DaffProductGridLoadSuccess(t.products),new _(t)]}),i.catchError(function(t){return c.of(new b("Failed to load the category"))}))},t.decorators=[{type:r.Injectable}],t.ctorParameters=function(){return[{type:a.Actions},{type:void 0,decorators:[{type:r.Inject,args:[k]}]},{type:o.Store}]},p([a.Effect(),f("design:type",c.Observable)],t.prototype,"loadCategoryPage$",void 0),p([a.Effect(),f("design:type",c.Observable)],t.prototype,"changeCategoryPageSize$",void 0),p([a.Effect(),f("design:type",c.Observable)],t.prototype,"changeCategoryCurrentPage$",void 0),p([a.Effect(),f("design:type",c.Observable)],t.prototype,"changeCategoryFilters$",void 0),p([a.Effect(),f("design:type",c.Observable)],t.prototype,"toggleCategoryFilter$",void 0),p([a.Effect(),f("design:type",c.Observable)],t.prototype,"changeCategorySort$",void 0),t}();var ot=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{imports:[o.StoreModule.forFeature("category",G),a.EffectsModule.forFeature([Q,rt])],providers:[{provide:N,useValue:12}]}]}],t}(),nt=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule,ot,s.DaffProductModule]}]}],t}(),at=function(){function t(t){this.store=t,this.categorySelectors=et(),this.category$=this.store.pipe(o.select(this.categorySelectors.selectSelectedCategory)),this.products$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageProducts)),this.totalProducts$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageTotalProducts)),this.pageConfigurationState$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageConfigurationState)),this.currentPage$=this.store.pipe(o.select(this.categorySelectors.selectCategoryCurrentPage)),this.totalPages$=this.store.pipe(o.select(this.categorySelectors.selectCategoryTotalPages)),this.pageSize$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageSize)),this.filters$=this.store.pipe(o.select(this.categorySelectors.selectCategoryFilters)),this.sortOptions$=this.store.pipe(o.select(this.categorySelectors.selectCategorySortOptions)),this.appliedFilters$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageAppliedFilters)),this.appliedSortOption$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageAppliedSortOption)),this.appliedSortDirection$=this.store.pipe(o.select(this.categorySelectors.selectCategoryPageAppliedSortDirection)),this.categoryLoading$=this.store.pipe(o.select(this.categorySelectors.selectCategoryLoading)),this.productsLoading$=this.store.pipe(o.select(this.categorySelectors.selectCategoryProductsLoading)),this.errors$=this.store.pipe(o.select(this.categorySelectors.selectCategoryErrors)),this.isCategoryEmpty$=this.store.pipe(o.select(this.categorySelectors.selectIsCategoryPageEmpty))}return t.prototype.getCategoryById=function(t){return this.store.pipe(o.select(this.categorySelectors.selectCategory,{id:t}))},t.prototype.getProductsByCategory=function(t){return this.store.pipe(o.select(this.categorySelectors.selectProductsByCategory,{id:t}))},t.prototype.getTotalProductsByCategory=function(t){return this.store.pipe(o.select(this.categorySelectors.selectTotalProductsByCategory,{id:t}))},t.prototype.dispatch=function(t){this.store.dispatch(t)},t.decorators=[{type:r.Injectable,args:[{providedIn:nt}]}],t.ctorParameters=function(){return[{type:o.Store}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.Store))},token:t,providedIn:nt}),t}();var it,ct,st=g(it||(it=C(["\nquery MagentoGetCategoryQuery($filters: CategoryFilterInput){\n\tcategoryList(filters: $filters) {\n\t\tid\n\t\tname\n\t\tlevel\n\t\tdescription\n\t\tbreadcrumbs {\n\t\t\tcategory_id\n\t\t\tcategory_name\n\t\t\tcategory_level\n\t\t\tcategory_url_key\n\t\t}\n\t\tproducts {\n\t\t\titems {\n\t\t\t\tsku\n\t\t\t}\n\t\t}\n\t\tchildren_count\n\t}\n}"],["\nquery MagentoGetCategoryQuery($filters: CategoryFilterInput){\n\tcategoryList(filters: $filters) {\n\t\tid\n\t\tname\n\t\tlevel\n\t\tdescription\n\t\tbreadcrumbs {\n\t\t\tcategory_id\n\t\t\tcategory_name\n\t\t\tcategory_level\n\t\t\tcategory_url_key\n\t\t}\n\t\tproducts {\n\t\t\titems {\n\t\t\t\tsku\n\t\t\t}\n\t\t}\n\t\tchildren_count\n\t}\n}"]))),ut=g(ct||(ct=C(["\nquery MagentoGetProducts($filter: ProductAttributeFilterInput!, $search: String, $pageSize: Int, $currentPage: Int, $sort: ProductAttributeSortInput)\n{\n\tproducts(filter: $filter, search: $search, pageSize: $pageSize, currentPage: $currentPage, sort: $sort)\n\t{\n\t\ttotal_count\n\t\titems {\n\t\t\t...product\n\t\t}\n\t\tpage_info {\n\t\t\tpage_size\n\t\t\tcurrent_page\n\t\t\ttotal_pages\n\t\t}\n\t}\n}\n","\n"],["\nquery MagentoGetProducts($filter: ProductAttributeFilterInput!, $search: String, $pageSize: Int, $currentPage: Int, $sort: ProductAttributeSortInput)\n{\n\tproducts(filter: $filter, search: $search, pageSize: $pageSize, currentPage: $currentPage, sort: $sort)\n\t{\n\t\ttotal_count\n\t\titems {\n\t\t\t...product\n\t\t}\n\t\tpage_info {\n\t\t\tpage_size\n\t\t\tcurrent_page\n\t\t\ttotal_pages\n\t\t}\n\t}\n}\n","\n"])),s.magentoProductFragment),gt="eq",lt="to",pt="from",ft="in",yt="match";var dt=function(){function t(){}return t.prototype.transform=function(t,e){var r,o=this,n={category_id:(r={},r[gt]=t,r)};return e?(e.forEach(function(t){var e;if(t.type===q.Range){var r=t.value[0].split(V);n[t.name]=l({},n[t.name],o.getRangeFromValue(r[0]),o.getRangeToValue(r[1]))}else n[t.name]=l({},n[t.name],((e={})[o.getFilterAction(t.type)]=o.getFilterValue(t.type,t.value),e))}),n):n},t.prototype.getFilterAction=function(t){return t===q.Equal?ft:yt},t.prototype.getFilterValue=function(t,e){return t===q.Equal?e:e[0]},t.prototype.getRangeFromValue=function(t){var e;return"*"!==t?((e={})[pt]=t,e):null},t.prototype.getRangeToValue=function(t){var e;return"*"!==t?((e={})[lt]=t,e):null},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),Ct="ASC",ht="DESC";var St={Ascending:"ASC",Decending:"DSC"};var mt=function(){function t(){}return t.prototype.transform=function(t,e){var r;return(r={})[t]=this.transformDirection(e),r},t.prototype.transformDirection=function(t){return t===St.Ascending?Ct:t===St.Decending?ht:void 0},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var vt=function(){function t(){}return t.prototype.transform=function(t){return{id:t.category.id,page_size:t.page_info.page_size,current_page:t.page_info.current_page,total_pages:t.page_info.total_pages,total_products:t.total_count,filters:t.aggregates.map(this.transformAggregate.bind(this)),sort_options:(e=t.sort_fields,r=e.options.findIndex(function(t){return e.default===t.value}),l({},e,{options:d([e.options[r]],e.options.slice(0,r),e.options.slice(r+1))})).options,product_ids:t.products.map(function(t){return t.sku})};var e,r},t.prototype.transformAggregate=function(t){var e=this,r=this.transformAggregateType(t.type);return{label:t.label,type:r,name:t.attribute_code,options:t.options.map(function(t){return{label:t.label,value:r===q.Range?e.transformRangeValue(t.value):t.value,count:t.count}})}},t.prototype.transformAggregateType=function(t){return"select"===t?q.Equal:"boolean"===t?q.Equal:"multiselect"===t?q.Equal:"price"===t?q.Range:q.Match},t.prototype.transformRangeValue=function(t){return t.replace("_",V)},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),Pt=function(){function t(){}return t.prototype.transform=function(t){var e=this;return{id:t.id,name:t.name,description:t.description,children_count:t.children_count,breadcrumbs:t.breadcrumbs?t.breadcrumbs.map(function(t){return e.transformBreadcrumb(t)}).sort(function(t,e){return t.categoryLevel-e.categoryLevel}):null,product_ids:t.products.items.map(function(t){return t.sku}),total_products:t.products.items.length}},t.prototype.transformBreadcrumb=function(t){return{categoryId:t.category_id,categoryName:t.category_name,categoryLevel:t.category_level,categoryUrlKey:t.category_url_key}},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),_t=function(){function t(t,e){this.magentoCategoryTransformerService=t,this.magentoCategoryPageConfigurationTransformerService=e}return t.prototype.transform=function(t){return l({magentoCompleteCategoryResponse:t},{category:this.magentoCategoryTransformerService.transform(t.category),categoryPageConfigurationState:this.magentoCategoryPageConfigurationTransformerService.transform(t),products:s.transformManyMagentoProducts(t.products)})},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:Pt},{type:vt}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(Pt),r.ɵɵinject(vt))},token:t,providedIn:"root"}),t}();var bt,At,It=g(bt||(bt=C(["\nquery MagentoGetProducts($filter: ProductAttributeFilterInput!)\n{\n\tproducts(filter: $filter)\n\t{\n\t\taggregations {\n\t\t\tlabel\n\t\t\tcount\n\t\t\tattribute_code\n\t\t\toptions {\n\t\t\t\t\tcount\n\t\t\t\t\tlabel\n\t\t\t\t\tvalue\n\t\t\t}\n\t\t}\n\t\tsort_fields {\n\t\t\tdefault\n\t\t\toptions {\n\t\t\t\tlabel\n\t\t\t\tvalue\n\t\t\t}\n\t\t}\n\t}\n}"],["\nquery MagentoGetProducts($filter: ProductAttributeFilterInput!)\n{\n\tproducts(filter: $filter)\n\t{\n\t\taggregations {\n\t\t\tlabel\n\t\t\tcount\n\t\t\tattribute_code\n\t\t\toptions {\n\t\t\t\t\tcount\n\t\t\t\t\tlabel\n\t\t\t\t\tvalue\n\t\t\t}\n\t\t}\n\t\tsort_fields {\n\t\t\tdefault\n\t\t\toptions {\n\t\t\t\tlabel\n\t\t\t\tvalue\n\t\t\t}\n\t\t}\n\t}\n}"]))),Lt=g(At||(At=C(["\nquery MagentoGetCustomAttributeMetadata($attributes: [AttributeInput!]!)\n{\n\tcustomAttributeMetadata(attributes: $attributes)\n\t{\n\t\titems {\n      attribute_code\n      attribute_type\n      input_type\n    }\n\t}\n}"],["\nquery MagentoGetCustomAttributeMetadata($attributes: [AttributeInput!]!)\n{\n\tcustomAttributeMetadata(attributes: $attributes)\n\t{\n\t\titems {\n      attribute_code\n      attribute_type\n      input_type\n    }\n\t}\n}"])));function Dt(t,e){return"category_id"===t.attribute_code?"select":e.customAttributeMetadata.items.filter(function(e){return e.attribute_code===t.attribute_code})[0].input_type}var $t=function(){function t(t,e,r,o){this.apollo=t,this.magentoCategoryResponseTransformer=e,this.magentoAppliedFiltersTransformer=r,this.magentoAppliedSortTransformer=o}return t.prototype.get=function(t){var e=this;return c.combineLatest([this.apollo.query({query:st,variables:{filters:{ids:{eq:t.id}}}}),this.apollo.query({query:It,variables:{filter:{category_id:{eq:t.id}}}}).pipe(i.switchMap(function(t){return e.apollo.query({query:Lt,variables:{attributes:t.data.products.aggregations.filter(function(t){return"category_id"!==t.attribute_code}).map(function(t){return{attribute_code:t.attribute_code,entity_type:"4"}})}}).pipe(i.map(function(e){return r=e.data,o=t.data,l({},o,{products:l({},o.products,{aggregations:d(o.products.aggregations.map(function(t){return l({},t,{type:Dt(t,r)})}))})});var r,o}))})),this.apollo.query({query:ut,variables:this.getProductsQueryVariables(t)})]).pipe(i.map(function(t){return e.buildCompleteCategoryResponse(t[0].data,t[1],t[2].data)}),i.map(function(t){return e.magentoCategoryResponseTransformer.transform(t)}))},t.prototype.getProductsQueryVariables=function(t){var e={filter:this.magentoAppliedFiltersTransformer.transform(t.id,t.filter_requests)};return t.page_size&&(e.pageSize=t.page_size),t.current_page&&(e.currentPage=t.current_page),t.applied_sort_option&&t.applied_sort_direction&&(e.sort=this.magentoAppliedSortTransformer.transform(t.applied_sort_option,t.applied_sort_direction)),e},t.prototype.buildCompleteCategoryResponse=function(t,e,r){return{category:t.categoryList[0],products:r.products.items,aggregates:e.products.aggregations,sort_fields:e.products.sort_fields,total_count:r.products.total_count,page_info:r.products.page_info}},t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:u.Apollo},{type:_t},{type:dt},{type:mt}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(u.Apollo),r.ɵɵinject(_t),r.ɵɵinject(dt),r.ɵɵinject(mt))},token:t,providedIn:"root"}),t}();var qt=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:k,useExisting:$t},vt,_t,Pt,dt,mt]}},t.decorators=[{type:r.NgModule,args:[{imports:[n.CommonModule]}]}],t}();t.DaffCategoryActionTypes=h,t.DaffCategoryDriver=k,t.DaffCategoryFacade=at,t.DaffCategoryFilterType=q,t.DaffCategoryFromToFilterSeparator=V,t.DaffCategoryLoad=S,t.DaffCategoryLoadFailure=v,t.DaffCategoryLoadSuccess=m,t.DaffCategoryMagentoDriverModule=qt,t.DaffCategoryModule=nt,t.DaffCategoryPageLoad=P,t.DaffCategoryPageLoadFailure=b,t.DaffCategoryPageLoadSuccess=_,t.DaffCategoryPageResolver=K,t.DaffChangeCategoryCurrentPage=I,t.DaffChangeCategoryFilters=D,t.DaffChangeCategoryPageSize=A,t.DaffChangeCategorySortingOption=L,t.DaffDefaultCategoryPageSize=N,t.DaffMagentoAppliedFiltersTransformService=dt,t.DaffMagentoAppliedSortOptionTransformService=mt,t.DaffMagentoCategoryPageConfigTransformerService=vt,t.DaffMagentoCategoryResponseTransformService=_t,t.DaffMagentoCategoryService=$t,t.DaffMagentoCategoryTransformerService=Pt,t.DaffSortDirectionEnum=St,t.DaffToggleCategoryFilter=$,t.MagentoGetCategoryQuery=st,t.MagentoGetProductsQuery=ut,t.daffCategoryReducers=G,t.daffCategoryValidateFilters=B,t.getDaffCategorySelectors=et,t.ɵa=z,t.ɵb=x,t.ɵc=ot,t.ɵd=Q,t.ɵe=rt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-category.umd.min.js.map