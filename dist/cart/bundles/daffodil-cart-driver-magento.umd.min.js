!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@daffodil/cart"),require("@daffodil/product"),require("@daffodil/core"),require("graphql-tag"),require("@daffodil/core/graphql"),require("apollo-angular"),require("rxjs"),require("rxjs/operators"),require("@daffodil/cart/driver"),require("@daffodil/driver/magento"),require("@daffodil/driver"),require("@angular/common")):"function"==typeof define&&define.amd?define("@daffodil/cart/driver/magento",["exports","@angular/core","@daffodil/cart","@daffodil/product","@daffodil/core","graphql-tag","@daffodil/core/graphql","apollo-angular","rxjs","rxjs/operators","@daffodil/cart/driver","@daffodil/driver/magento","@daffodil/driver","@angular/common"],n):n(((t=t||self).daffodil=t.daffodil||{},t.daffodil.cart=t.daffodil.cart||{},t.daffodil.cart.driver=t.daffodil.cart.driver||{},t.daffodil.cart.driver.magento={}),t.ng.core,t.daffodil.cart,t.product,t.core$1,t.gql,t.graphql,t.apolloAngular,t.rxjs,t.rxjs.operators,t.daffodil.cart.driver,t.magento,t.driver$1,t.ng.common)}(this,function(t,n,r,e,a,i,o,d,s,p,u,c,l,m){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var f=function(){return(f=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)};function g(t,n){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var e,a,i=r.call(t),o=[];try{for(;(void 0===n||n-- >0)&&!(e=i.next()).done;)o.push(e.value)}catch(t){a={error:t}}finally{try{e&&!e.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return o}function h(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(g(arguments[n]));return t}function y(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t}var I=function(){function t(){}return t.prototype.transform=function(t){return t?f({magento_payment_method:t},{method:t.code}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),_=function(){function t(){}return t.prototype.transform=function(t){return t?f({magento_shipping_method:t},{carrier:t.carrier_code,carrier_title:t.carrier_title,price:t.amount.value,method_code:t.method_code,method_title:t.method_title,id:null,method_description:null}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),v=function(){function t(t){this.shippingRateTransformer=t}return t.prototype.transform=function(t){return t?f({},this.shippingRateTransformer.transform(t),{address_id:0}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:_}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(_))},token:t,providedIn:"root"}),t}();var C=function(){function t(){}return t.prototype.transform=function(t){return t?f({magento_address:t},{street:t.street[0],city:t.city,region:t.region.code,country:t.country.label,country_id:t.country.code,postcode:t.postcode,firstname:t.firstname,lastname:t.lastname,telephone:t.telephone,email:t.email,address_id:null,suffix:null,middlename:null,prefix:null,address_type:null}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),b=function(){function t(t){this.addressTransformer=t}return t.prototype.transform=function(t){return t?f({},this.addressTransformer.transform(t),{address_type:"shipping"}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:C}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(C))},token:t,providedIn:"root"}),t}();var S=function(){function t(t){this.addressTransformer=t}return t.prototype.transform=function(t){return t?f({},this.addressTransformer.transform(t),{address_type:"billing"}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:C}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(C))},token:t,providedIn:"root"}),t}();function $(t){return f({magento_coupon:t},{code:t.code})}var A={Simple:"SimpleCartItem",Bundle:"BundleCartItem",Configurable:"ConfigurableCartItem"};function T(t){return t?f({magento_cart_item:t},{type:r.DaffCartItemInputType.Simple,item_id:t.id,sku:t.product.sku,name:t.product.name,qty:t.quantity,price:t.prices.price.value,row_total:t.prices.row_total.value,product_id:String(t.product.id),image:{id:t.product.thumbnail.label,url:t.product.thumbnail.url,label:t.product.thumbnail.label},total_discount:t.prices.total_item_discount.value,in_stock:t.product.stock_status===e.MagentoProductStockStatusEnum.InStock,parent_item_id:0}):null}function j(t){return{option_id:t.values[0].id,option_label:t.label,value_label:t.values[0].label}}function D(t){return{attribute_label:t.option_label,value_label:t.value_label}}function M(t){switch(t.__typename){case A.Bundle:return(e=t)?f({},T(e),{type:r.DaffCartItemInputType.Composite,options:e.bundle_options.map(j)}):null;case A.Configurable:return(n=t)?f({},T(n),{type:r.DaffCartItemInputType.Configurable,attributes:n.configurable_options.map(D)}):null;default:return T(t)}var n,e}function F(t){var n,e=t.prices.applied_taxes?t.prices.applied_taxes.reduce(function(t,n){return a.daffAdd(t,n.amount.value)},0):0;return{totals:h([{name:r.DaffCartTotalTypeEnum.grandTotal,label:"Grand Total",value:t.prices.grand_total.value},{name:r.DaffCartTotalTypeEnum.subtotalExcludingTax,label:"Subtotal Excluding Tax",value:t.prices.subtotal_excluding_tax.value},{name:r.DaffCartTotalTypeEnum.subtotalIncludingTax,label:"Subtotal Including Tax",value:t.prices.subtotal_including_tax.value},{name:r.DaffCartTotalTypeEnum.subtotalWithDiscountExcludingTax,label:"Subtotal with Discount Excluding Tax",value:t.prices.subtotal_with_discount_excluding_tax.value},{name:r.DaffCartTotalTypeEnum.subtotalWithDiscountIncludingTax,label:"Subtotal with Discount Including Tax",value:t.prices.subtotal_with_discount_excluding_tax.value?a.daffAdd(t.prices.subtotal_with_discount_excluding_tax.value,e):t.prices.subtotal_with_discount_excluding_tax.value},{name:r.DaffCartTotalTypeEnum.tax,label:"Tax",value:e}],(n=t.prices.discounts,n?n.map(function(t){return{name:r.DaffCartTotalTypeEnum.discount,label:t.label,value:t.amount.value}}):[]),[{name:r.DaffCartTotalTypeEnum.shipping,label:"Shipping",value:B(t)?t.shipping_addresses[0].selected_shipping_method.amount.value:null}])}}function B(t){return!!(t.shipping_addresses&&t.shipping_addresses[0]&&t.shipping_addresses[0].selected_shipping_method&&t.shipping_addresses[0].selected_shipping_method.amount)}var x=function(){function t(t,n,r,e,a){this.shippingAddressTransformer=t,this.billingAddressTransformer=n,this.paymentTransformer=r,this.shippingInformationTransformer=e,this.shippingRateTransformer=a}return t.prototype.transformShippingAddress=function(t){return{shipping_address:t.shipping_addresses[0]?this.shippingAddressTransformer.transform(f({},t.shipping_addresses[0],{email:t.email})):null}},t.prototype.transformBillingAddress=function(t){return{billing_address:t.billing_address?this.billingAddressTransformer.transform(f({},t.billing_address,{email:t.email})):null}},t.prototype.transformCartItems=function(t){return{items:t.items.map(M)}},t.prototype.transformTotals=function(t){return{grand_total:t.prices.grand_total.value,subtotal:t.prices.subtotal_excluding_tax.value}},t.prototype.transformCoupons=function(t){return{coupons:t.applied_coupons?t.applied_coupons.map($):[]}},t.prototype.transformPayment=function(t){return{payment:this.paymentTransformer.transform(t.selected_payment_method)}},t.prototype.transformShippingInformation=function(t){return{shipping_information:t.shipping_addresses[0]?this.shippingInformationTransformer.transform(t.shipping_addresses[0].selected_shipping_method):null}},t.prototype.transformShippingMethods=function(t){var n=this;return{available_shipping_methods:t.shipping_addresses[0]&&t.shipping_addresses[0].available_shipping_methods?t.shipping_addresses[0].available_shipping_methods.map(function(t){return n.shippingRateTransformer.transform(t)}):[]}},t.prototype.transformPaymentMethods=function(t){var n=this;return{available_payment_methods:t.available_payment_methods.map(function(t){return n.paymentTransformer.transform(t)})}},t.prototype.transform=function(t){return t?f({extra_attributes:t},this.transformCartItems(t),this.transformBillingAddress(t),this.transformShippingAddress(t),this.transformCoupons(t),this.transformPayment(t),this.transformTotals(t),F(t),this.transformShippingInformation(t),this.transformShippingMethods(t),this.transformPaymentMethods(t),{id:t.id}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:b},{type:S},{type:I},{type:v},{type:_}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(b),n.ɵɵinject(S),n.ɵɵinject(I),n.ɵɵinject(v),n.ɵɵinject(_))},token:t,providedIn:"root"}),t}();var P=function(){function t(){}return t.prototype.transform=function(t){return{city:t.city,country_code:t.country,firstname:t.firstname,lastname:t.lastname,postcode:t.postcode,region:String(t.region),save_in_address_book:!1,street:[t.street],telephone:t.telephone}},t.decorators=[{type:n.Injectable}],t}(),E=function(){function t(t){this.cartAddressTransformer=t}return t.prototype.transform=function(t){return t.address_id?{address:null,customer_address_id:t.address_id}:{address:this.cartAddressTransformer.transform(t),customer_address_id:null}},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:P}]},t}();var O=function(){function t(t){this.cartAddressTransformer=t}return t.prototype.transform=function(t){return t.address_id?{address:null,customer_address_id:t.address_id}:{address:this.cartAddressTransformer.transform(t),customer_address_id:null}},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:P}]},t}();var q=function(){function t(){}return t.prototype.transform=function(t){return{quantity:t.qty,cart_item_id:Number(t.item_id)}},t.decorators=[{type:n.Injectable}],t}(),w=function(){function t(){}return t.prototype.transform=function(t){return f({},t.payment_info)},t.decorators=[{type:n.Injectable}],t}(),Q=function(){function t(){}return t.prototype.transform=function(t){return{carrier_code:t.carrier,method_code:t.method_code}},t.decorators=[{type:n.Injectable}],t}();var k,N,G,R,U,W,L,X,J,V,z=new n.InjectionToken("DAFF_CART_MAGENTO_EXTRA_CART_FRAGMENTS",{factory:function(){return[]}}),H=i(k||(k=y(["\n  fragment money on Money {\n    value\n    currency\n  }\n"],["\n  fragment money on Money {\n    value\n    currency\n  }\n"]))),K=i(N||(N=y(["\n  fragment cartCoupon on AppliedCoupon {\n    code\n  }\n"],["\n  fragment cartCoupon on AppliedCoupon {\n    code\n  }\n"]))),Y=i(G||(G=y(["\n  fragment cartAddress on CartAddressInterface {\n    city\n    country {\n      code\n      label\n    }\n    firstname\n    lastname\n    postcode\n    region {\n      code\n      label\n    }\n    street\n    telephone\n    company\n  }\n"],["\n  fragment cartAddress on CartAddressInterface {\n    city\n    country {\n      code\n      label\n    }\n    firstname\n    lastname\n    postcode\n    region {\n      code\n      label\n    }\n    street\n    telephone\n    company\n  }\n"]))),Z=i(R||(R=y(["\n  fragment cartItem on CartItemInterface {\n\t\t__typename\n    id\n    product {\n      ...product\n    }\n    quantity\n    prices {\n      price {\n        ...money\n      }\n      row_total {\n        ...money\n      }\n      row_total_including_tax {\n        ...money\n      }\n      total_item_discount {\n        ...money\n      }\n\t\t}\n\t\t...on ConfigurableCartItem {\n\t\t\tconfigurable_options {\n\t\t\t\toption_label\n\t\t\t\tvalue_label\n\t\t\t}\n\t\t}\n\t\t...on BundleCartItem {\n\t\t\tbundle_options {\n\t\t\t\tid\n\t\t\t\tlabel\n\t\t\t\ttype\n\t\t\t\tvalues {\n\t\t\t\t\tid\n\t\t\t\t\tlabel\n\t\t\t\t\tprice\n\t\t\t\t\tquantity\n\t\t\t\t}\n\t\t\t}\n\t\t}\n  }\n  ","\n  ","\n"],["\n  fragment cartItem on CartItemInterface {\n\t\t__typename\n    id\n    product {\n      ...product\n    }\n    quantity\n    prices {\n      price {\n        ...money\n      }\n      row_total {\n        ...money\n      }\n      row_total_including_tax {\n        ...money\n      }\n      total_item_discount {\n        ...money\n      }\n\t\t}\n\t\t...on ConfigurableCartItem {\n\t\t\tconfigurable_options {\n\t\t\t\toption_label\n\t\t\t\tvalue_label\n\t\t\t}\n\t\t}\n\t\t...on BundleCartItem {\n\t\t\tbundle_options {\n\t\t\t\tid\n\t\t\t\tlabel\n\t\t\t\ttype\n\t\t\t\tvalues {\n\t\t\t\t\tid\n\t\t\t\t\tlabel\n\t\t\t\t\tprice\n\t\t\t\t\tquantity\n\t\t\t\t}\n\t\t\t}\n\t\t}\n  }\n  ","\n  ","\n"])),e.magentoProductFragment,H),tt=i(U||(U=y(["\n  fragment availablePaymentMethod on AvailablePaymentMethod {\n    code\n    title\n  }\n"],["\n  fragment availablePaymentMethod on AvailablePaymentMethod {\n    code\n    title\n  }\n"]))),nt=i(W||(W=y(["\n  fragment selectedPaymentMethod on SelectedPaymentMethod {\n    code\n    title\n    purchase_order_number\n  }\n"],["\n  fragment selectedPaymentMethod on SelectedPaymentMethod {\n    code\n    title\n    purchase_order_number\n  }\n"]))),rt=i(L||(L=y(["\n  fragment availableShippingMethod on AvailableShippingMethod {\n    carrier_code\n    method_code\n    carrier_title\n    method_title\n    amount {\n      ...money\n    }\n  }\n  ","\n"],["\n  fragment availableShippingMethod on AvailableShippingMethod {\n    carrier_code\n    method_code\n    carrier_title\n    method_title\n    amount {\n      ...money\n    }\n  }\n  ","\n"])),H),et=i(X||(X=y(["\n  fragment selectedShippingMethod on SelectedShippingMethod {\n    carrier_code\n    method_code\n    carrier_title\n    method_title\n    amount {\n      ...money\n    }\n  }\n  ","\n"],["\n  fragment selectedShippingMethod on SelectedShippingMethod {\n    carrier_code\n    method_code\n    carrier_title\n    method_title\n    amount {\n      ...money\n    }\n  }\n  ","\n"])),H),at=i(J||(J=y(["\n  fragment prices on CartPrices {\n\t\tgrand_total {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_excluding_tax {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_including_tax {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_with_discount_excluding_tax {\n\t\t\t...money\n\t\t}\n\t\tapplied_taxes {\n\t\t\tamount {\n\t\t\t\t...money\n\t\t\t}\n\t\t\tlabel\n\t\t}\n\t\tdiscounts {\n\t\t\tamount {\n\t\t\t\t...money\n\t\t\t}\n\t\t\tlabel\n\t\t}\n\t}\n  ","\n"],["\n  fragment prices on CartPrices {\n\t\tgrand_total {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_excluding_tax {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_including_tax {\n\t\t\t...money\n\t\t}\n\t\tsubtotal_with_discount_excluding_tax {\n\t\t\t...money\n\t\t}\n\t\tapplied_taxes {\n\t\t\tamount {\n\t\t\t\t...money\n\t\t\t}\n\t\t\tlabel\n\t\t}\n\t\tdiscounts {\n\t\t\tamount {\n\t\t\t\t...money\n\t\t\t}\n\t\t\tlabel\n\t\t}\n\t}\n  ","\n"])),H),it=i(V||(V=y(["\n  fragment cart on Cart {\n    id\n    email\n    billing_address {\n      ...cartAddress\n    }\n    shipping_addresses {\n      ...cartAddress\n      ... on ShippingCartAddress {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n    }\n    items {\n      ...cartItem\n    }\n    available_payment_methods {\n      ...availablePaymentMethod\n    }\n    selected_payment_method {\n      ...selectedPaymentMethod\n    }\n    applied_coupons {\n      ...cartCoupon\n    }\n    prices {\n      ...prices\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"],["\n  fragment cart on Cart {\n    id\n    email\n    billing_address {\n      ...cartAddress\n    }\n    shipping_addresses {\n      ...cartAddress\n      ... on ShippingCartAddress {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n    }\n    items {\n      ...cartItem\n    }\n    available_payment_methods {\n      ...availablePaymentMethod\n    }\n    selected_payment_method {\n      ...selectedPaymentMethod\n    }\n    applied_coupons {\n      ...cartCoupon\n    }\n    prices {\n      ...prices\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"])),Y,tt,nt,et,Z,at,K);var ot,dt,st,pt,ut,ct,lt,mt,ft,gt,ht,yt,It,_t,vt,Ct,bt,St,$t,At,Tt,jt,Dt,Mt,Ft,Bt,xt,Pt,Et,Ot,qt,wt=function(t){return void 0===t&&(t=[]),i(ot||(ot=y(["\n  query ListCartItems($cartId: String!) {\n    cart(cart_id: $cartId) {\n      items {\n        ...cartItem\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query ListCartItems($cartId: String!) {\n    cart(cart_id: $cartId) {\n      items {\n        ...cartItem\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),Z,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Qt=function(t){return void 0===t&&(t=[]),i(dt||(dt=y(["\n  mutation AddSimpleCartItem($cartId: String!, $input: CartItemInput!) {\n    addSimpleProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n        data: $input\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation AddSimpleCartItem($cartId: String!, $input: CartItemInput!) {\n    addSimpleProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n        data: $input\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},kt=function(t){return void 0===t&&(t=[]),i(st||(st=y(["\n  mutation AddBundleCartItem($cartId: String!, $input: CartItemInput!, $options: [BundleOptionInput]!) {\n    addBundleProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n\t\t\t\tdata: $input,\n\t\t\t\tbundle_options: $options\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation AddBundleCartItem($cartId: String!, $input: CartItemInput!, $options: [BundleOptionInput]!) {\n    addBundleProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n\t\t\t\tdata: $input,\n\t\t\t\tbundle_options: $options\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Nt=function(t){return void 0===t&&(t=[]),i(pt||(pt=y(["\n  mutation AddConfigurableCartItem($cartId: String!, $parentSku: String, $data: CartItemInput!) {\n    addConfigurableProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n\t\t\t\tparent_sku: $parentSku\n\t\t\t\tdata: $data,\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation AddConfigurableCartItem($cartId: String!, $parentSku: String, $data: CartItemInput!) {\n    addConfigurableProductsToCart(input: {\n      cart_id: $cartId,\n      cart_items: [{\n\t\t\t\tparent_sku: $parentSku\n\t\t\t\tdata: $data,\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Gt=function(t){return void 0===t&&(t=[]),i(ut||(ut=y(["\n  mutation RemoveCartItem($cartId: String!, $itemId: Int!) {\n    removeItemFromCart(input: {\n      cart_id: $cartId,\n      cart_item_id: $itemId\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation RemoveCartItem($cartId: String!, $itemId: Int!) {\n    removeItemFromCart(input: {\n      cart_id: $cartId,\n      cart_item_id: $itemId\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Rt=function(t){return void 0===t&&(t=[]),i(ct||(ct=y(["\n  mutation UpdateCartItem($cartId: String!, $input: CartItemUpdateInput!) {\n    updateCartItems(input: {\n      cart_id: $cartId\n      cart_items: [$input]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateCartItem($cartId: String!, $input: CartItemUpdateInput!) {\n    updateCartItems(input: {\n      cart_id: $cartId\n      cart_items: [$input]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Ut=function(t){return void 0===t&&(t=[]),i(lt||(lt=y(["\n  query ListPaymentMethods($cartId: String!) {\n    cart(cart_id: $cartId) {\n      available_payment_methods {\n        ...availablePaymentMethod\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query ListPaymentMethods($cartId: String!) {\n    cart(cart_id: $cartId) {\n      available_payment_methods {\n        ...availablePaymentMethod\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),tt,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Wt=function(t){return void 0===t&&(t=[]),i(mt||(mt=y(["\n  query GetSelectedPaymentMethod($cartId: String!) {\n    cart(cart_id: $cartId) {\n      selected_payment_method {\n        ...selectedPaymentMethod\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query GetSelectedPaymentMethod($cartId: String!) {\n    cart(cart_id: $cartId) {\n      selected_payment_method {\n        ...selectedPaymentMethod\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),nt,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Lt=function(t){return void 0===t&&(t=[]),i(ft||(ft=y(["\n  mutation SetSelectedPaymentMethod($cartId: String!, $payment: PaymentMethodInput!) {\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation SetSelectedPaymentMethod($cartId: String!, $payment: PaymentMethodInput!) {\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Xt=function(t){return void 0===t&&(t=[]),i(gt||(gt=y(["\n  mutation SetSelectedPaymentMethodWithBilling(\n    $cartId: String!,\n    $payment: PaymentMethodInput!,\n    $address: BillingAddressInput!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        id\n      }\n    }\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation SetSelectedPaymentMethodWithBilling(\n    $cartId: String!,\n    $payment: PaymentMethodInput!,\n    $address: BillingAddressInput!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        id\n      }\n    }\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Jt=function(t){return void 0===t&&(t=[]),i(ht||(ht=y(["\n  mutation SetSelectedPaymentMethodWithBillingAndEmail(\n    $cartId: String!,\n    $payment: PaymentMethodInput!,\n    $address: BillingAddressInput!,\n    $email: String!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        id\n      }\n    }\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        id\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation SetSelectedPaymentMethodWithBillingAndEmail(\n    $cartId: String!,\n    $payment: PaymentMethodInput!,\n    $address: BillingAddressInput!,\n    $email: String!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        id\n      }\n    }\n    setPaymentMethodOnCart(input: {\n      cart_id: $cartId\n      payment_method: $payment\n    }) {\n      cart {\n        id\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Vt=function(t){return void 0===t&&(t=[]),i(yt||(yt=y(["\n  query ListShippingMethods($cartId: String!) {\n    cart(cart_id: $cartId) {\n      id\n      shipping_addresses {\n        available_shipping_methods {\n          ...availableShippingMethod\n        }\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query ListShippingMethods($cartId: String!) {\n    cart(cart_id: $cartId) {\n      id\n      shipping_addresses {\n        available_shipping_methods {\n          ...availableShippingMethod\n        }\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),rt,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},zt=function(t){return void 0===t&&(t=[]),i(It||(It=y(["\n  query GetSelectedShippingMethod($cartId: String!) {\n    cart(cart_id: $cartId) {\n      shipping_addresses {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query GetSelectedShippingMethod($cartId: String!) {\n    cart(cart_id: $cartId) {\n      shipping_addresses {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),et,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Ht=function(t){return void 0===t&&(t=[]),i(_t||(_t=y(["\n  mutation SetSelectedShippingMethod($cartId: String!, $method: ShippingMethodInput!) {\n    setShippingMethodsOnCart(input: {\n      cart_id: $cartId\n      shipping_methods: [$method]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation SetSelectedShippingMethod($cartId: String!, $method: ShippingMethodInput!) {\n    setShippingMethodsOnCart(input: {\n      cart_id: $cartId\n      shipping_methods: [$method]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Kt=function(t){return void 0===t&&(t=[]),i(vt||(vt=y(["\n  query GetBillingAddress($cartId: String!) {\n    cart(cart_id: $cartId) {\n      billing_address {\n        ...cartAddress\n      }\n      email\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query GetBillingAddress($cartId: String!) {\n    cart(cart_id: $cartId) {\n      billing_address {\n        ...cartAddress\n      }\n      email\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),Y,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Yt=function(t){return void 0===t&&(t=[]),i(Ct||(Ct=y(["\n  mutation UpdateBillingAddress(\n    $cartId: String!,\n    $address: BillingAddressInput!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateBillingAddress(\n    $cartId: String!,\n    $address: BillingAddressInput!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},Zt=function(t){return void 0===t&&(t=[]),i(bt||(bt=y(["\n  mutation UpdateBillingAddress(\n    $cartId: String!,\n    $address: BillingAddressInput!,\n    $email: String!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        email\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateBillingAddress(\n    $cartId: String!,\n    $address: BillingAddressInput!,\n    $email: String!\n  ) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: $address\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        email\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},tn=function(t){return void 0===t&&(t=[]),i(St||(St=y(["\n  query GetShippingAddress($cartId: String!) {\n    cart(cart_id: $cartId) {\n      shipping_addresses {\n        ...cartAddress\n      }\n      email\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query GetShippingAddress($cartId: String!) {\n    cart(cart_id: $cartId) {\n      shipping_addresses {\n        ...cartAddress\n      }\n      email\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),Y,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},nn=function(t){return void 0===t&&(t=[]),i($t||($t=y(["\n  mutation UpdateShippingAddress(\n    $cartId: String!,\n    $address: ShippingAddressInput!\n  ) {\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [$address]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateShippingAddress(\n    $cartId: String!,\n    $address: ShippingAddressInput!\n  ) {\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [$address]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},rn=function(t){return void 0===t&&(t=[]),i(At||(At=y(["\n  mutation UpdateShippingAddress(\n    $cartId: String!,\n    $address: ShippingAddressInput!,\n    $email: String!\n  ) {\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [$address]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        email\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateShippingAddress(\n    $cartId: String!,\n    $address: ShippingAddressInput!,\n    $email: String!\n  ) {\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [$address]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        email\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},en=function(t){return void 0===t&&(t=[]),i(Tt||(Tt=y(["\n  mutation UpdateAddress($cartId: String!, $address: CartAddressInput!) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: {\n        address: $address\n      }\n    }) {\n      cart {\n        id\n      }\n    }\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [{\n        address: $address\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateAddress($cartId: String!, $address: CartAddressInput!) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: {\n        address: $address\n      }\n    }) {\n      cart {\n        id\n      }\n    }\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [{\n        address: $address\n      }]\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},an=function(t){return void 0===t&&(t=[]),i(jt||(jt=y(["\n  mutation UpdateAddress($cartId: String!, $address: CartAddressInput!, $email: String!) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: {\n        address: $address\n      }\n    }) {\n      cart {\n        id\n      }\n    }\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [{\n        address: $address\n      }]\n    }) {\n      cart {\n        id\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"],["\n  mutation UpdateAddress($cartId: String!, $address: CartAddressInput!, $email: String!) {\n    setBillingAddressOnCart(input: {\n      cart_id: $cartId\n      billing_address: {\n        address: $address\n      }\n    }) {\n      cart {\n        id\n      }\n    }\n    setShippingAddressesOnCart(input: {\n      cart_id: $cartId\n      shipping_addresses: [{\n        address: $address\n      }]\n    }) {\n      cart {\n        id\n      }\n    }\n    setGuestEmailOnCart(input: {\n      cart_id: $cartId,\n      email: $email\n    }) {\n      cart {\n        ...cart\n        ","\n      }\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},on=function(t){return void 0===t&&(t=[]),i(Dt||(Dt=y(["\n  query GetCart($cartId: String!) {\n    cart(cart_id: $cartId) {\n      ...cart\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query GetCart($cartId: String!) {\n    cart(cart_id: $cartId) {\n      ...cart\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),it,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},dn=i(Mt||(Mt=y(["\n  mutation CreateCart {\n    createEmptyCart\n  }\n"],["\n  mutation CreateCart {\n    createEmptyCart\n  }\n"]))),sn=i(Ft||(Ft=y(["\n  mutation PlaceOrder($cartId: String!) {\n    placeOrder(\n      input: {\n        cart_id: $cartId\n      }\n    ) {\n      order {\n        order_number\n      }\n    }\n  }\n"],["\n  mutation PlaceOrder($cartId: String!) {\n    placeOrder(\n      input: {\n        cart_id: $cartId\n      }\n    ) {\n      order {\n        order_number\n      }\n    }\n  }\n"]))),pn=i(Bt||(Bt=y(["\n  fragment cartTotals on Cart {\n    id\n    shipping_addresses {\n      ...cartAddress\n      ... on ShippingCartAddress {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n    }\n    prices {\n      ...prices\n    }\n  }\n  ","\n  ","\n  ","\n"],["\n  fragment cartTotals on Cart {\n    id\n    shipping_addresses {\n      ...cartAddress\n      ... on ShippingCartAddress {\n        selected_shipping_method {\n          ...selectedShippingMethod\n        }\n      }\n    }\n    prices {\n      ...prices\n    }\n  }\n  ","\n  ","\n  ","\n"])),Y,et,at),un=function(t){return void 0===t&&(t=[]),i(xt||(xt=y(["\n  mutation ApplyCoupon($cartId: String!, $couponCode: String!) {\n    applyCouponToCart(\n      input: {\n        cart_id: $cartId,\n        coupon_code: $couponCode\n      }\n    ) {\n      cart {\n        id\n        items {\n          ...cartItem\n        }\n        applied_coupons {\n          ...cartCoupon\n\t\t\t\t}\n\t\t\t\t...cartTotals\n        ","\n      }\n    }\n  }\n  ","\n\t","\n\t","\n  ","\n"],["\n  mutation ApplyCoupon($cartId: String!, $couponCode: String!) {\n    applyCouponToCart(\n      input: {\n        cart_id: $cartId,\n        coupon_code: $couponCode\n      }\n    ) {\n      cart {\n        id\n        items {\n          ...cartItem\n        }\n        applied_coupons {\n          ...cartCoupon\n\t\t\t\t}\n\t\t\t\t...cartTotals\n        ","\n      }\n    }\n  }\n  ","\n\t","\n\t","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),Z,K,pn,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},cn=function(t){return void 0===t&&(t=[]),i(Pt||(Pt=y(["\n  query listCartCoupons($cartId: String!) {\n    cart(cart_id: $cartId) {\n      applied_coupons {\n\t\t\t\t...cartCoupon\n\t\t\t}\n      ","\n    }\n  }\n  ","\n  ","\n"],["\n  query listCartCoupons($cartId: String!) {\n    cart(cart_id: $cartId) {\n      applied_coupons {\n\t\t\t\t...cartCoupon\n\t\t\t}\n      ","\n    }\n  }\n  ","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),K,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},ln=function(t){return void 0===t&&(t=[]),i(Et||(Et=y(["\n  mutation RemoveAllCoupons($cartId: String!) {\n    removeCouponFromCart(\n      input: {\n        cart_id: $cartId\n      }\n    ) {\n      cart {\n        id\n        items {\n          ...cartItem\n        }\n        applied_coupons {\n          ...cartCoupon\n\t\t\t\t}\n\t\t\t\t...cartTotals\n        ","\n      }\n    }\n  }\n  ","\n\t","\n\t","\n  ","\n"],["\n  mutation RemoveAllCoupons($cartId: String!) {\n    removeCouponFromCart(\n      input: {\n        cart_id: $cartId\n      }\n    ) {\n      cart {\n        id\n        items {\n          ...cartItem\n        }\n        applied_coupons {\n          ...cartCoupon\n\t\t\t\t}\n\t\t\t\t...cartTotals\n        ","\n      }\n    }\n  }\n  ","\n\t","\n\t","\n  ","\n"])),o.daffBuildFragmentNameSpread.apply(void 0,h(t)),Z,K,pn,o.daffBuildFragmentDefinition.apply(void 0,h(t)))},mn="graphql-input",fn=((Ot={})["graphql-no-such-entity"]=u.DaffCartNotFoundError,Ot[mn]=l.DaffBadInputError,Ot),gn=((qt={})[u.DaffCartDriverErrorCodes.INVALID_COUPON_CODE]=/The coupon code isn\'t valid/,qt);function hn(t){return t.graphQLErrors&&t.graphQLErrors.length?function(t){for(var n in gn){if(t.graphQLErrors[0].message.search(gn[n])>-1&&u.DaffCartDriverErrorMap[n])return new u.DaffCartDriverErrorMap[n](t.message)}return c.daffTransformMagentoError(t,fn)}(t):c.daffTransformMagentoError(t,fn)}var yn=new n.InjectionToken("DAFF_MAGENTO_CART_MUTATION_QUEUE",{providedIn:"root",factory:function(){return new o.DaffQueuedApollo(n.inject(d.Apollo))}}),In=function(){function t(t,n,r,e,a){this.apollo=t,this.mutationQueue=n,this.cartTransformer=r,this.cartItemDriver=e,this.extraCartFragments=a}return t.prototype.get=function(t){var n=this;return this.apollo.query({query:on(this.extraCartFragments),variables:{cartId:t}}).pipe(p.catchError(function(t){return s.throwError(hn(t))}),p.map(function(t){return n.cartTransformer.transform(t.data.cart)}))},t.prototype.create=function(){return this.mutationQueue.mutate({mutation:dn}).pipe(p.map(function(t){return{id:t.data.createEmptyCart}}))},t.prototype.addToCart=function(t,n){throw new Error("Method is deprecated. Use DaffCartItemServiceInterface#add instead.")},t.prototype.clear=function(t){var n=this;return this.cartItemDriver.list(t).pipe(p.switchMap(function(r){return s.forkJoin.apply(void 0,h(r.map(function(r){return n.cartItemDriver.delete(t,r.item_id)})))}),p.switchMap(function(){return n.get(t)}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:x},{type:void 0,decorators:[{type:n.Inject,args:[u.DaffCartItemDriver]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(x),n.ɵɵinject(u.DaffCartItemDriver),n.ɵɵinject(z))},token:t,providedIn:"root"}),t}();function _n(t){return{quantity:t.qty,sku:t.productId}}function vn(t){return{id:Number(t.code),quantity:t.quantity,value:[t.value]}}var Cn=function(){function t(t,n,r,e,a){this.apollo=t,this.mutationQueue=n,this.extraCartFragments=r,this.cartTransformer=e,this.cartItemUpdateInputTransformer=a}return t.prototype.list=function(t){return this.apollo.query({query:wt(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.items.map(M)}))},t.prototype.get=function(t,n){return this.list(t).pipe(p.map(function(t){return t.find(function(t){return Number(t.item_id)===n})}))},t.prototype.add=function(t,n){switch(n.type){case r.DaffCartItemInputType.Composite:return this.addBundledProduct(t,n);case r.DaffCartItemInputType.Configurable:return this.addConfigurableProduct(t,n);default:return this.addSimpleProduct(t,n)}},t.prototype.update=function(t,n,r){var e=this;return this.mutationQueue.mutate({mutation:Rt(this.extraCartFragments),variables:{cartId:t,input:this.cartItemUpdateInputTransformer.transform(f({},r,{item_id:n}))}}).pipe(p.map(function(t){return e.cartTransformer.transform(t.data.updateCartItems.cart)}))},t.prototype.delete=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Gt(this.extraCartFragments),variables:{cartId:t,itemId:n}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.removeItemFromCart.cart)}))},t.prototype.addBundledProduct=function(t,n){var r,e=this,a={input:_n(r=n),options:r.options?r.options.map(vn):[]};return this.mutationQueue.mutate({mutation:kt(this.extraCartFragments),variables:{cartId:t,input:a.input,options:a.options}}).pipe(p.map(function(t){return e.cartTransformer.transform(t.data.addBundleProductsToCart.cart)}))},t.prototype.addConfigurableProduct=function(t,n){var r,e=this,a={parentSku:(r=n).productId,data:{quantity:r.qty,sku:String(r.variantId)}};return this.mutationQueue.mutate({mutation:Nt(this.extraCartFragments),variables:{cartId:t,parentSku:a.parentSku,data:a.data}}).pipe(p.map(function(t){return e.cartTransformer.transform(t.data.addConfigurableProductsToCart.cart)}))},t.prototype.addSimpleProduct=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Qt(this.extraCartFragments),variables:{cartId:t,input:_n(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.addSimpleProductsToCart.cart)}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:x},{type:q}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(x),n.ɵɵinject(q))},token:t,providedIn:"root"}),t}();var bn=function(){function t(t,n,r,e,a,i,o){this.apollo=t,this.mutationQueue=n,this.cartTransformer=r,this.paymentTransformer=e,this.paymentInputTransformer=a,this.cartAddressInputTransformer=i,this.extraCartFragments=o}return t.prototype.get=function(t){var n=this;return this.apollo.query({query:Wt(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return n.paymentTransformer.transform(t.data.cart.selected_payment_method)}))},t.prototype.update=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Lt(this.extraCartFragments),variables:{cartId:t,payment:this.paymentInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setPaymentMethodOnCart.cart)}))},t.prototype.updateWithBilling=function(t,n,r){return r.email?this.updateWithBillingAddressAndEmail(t,n,r):this.updateWithBillingAddress(t,n,r)},t.prototype.remove=function(t){return this.mutationQueue.mutate({mutation:Lt(this.extraCartFragments),variables:{cartId:t,payment:{code:""}}}).pipe(p.mapTo(void 0))},t.prototype.updateWithBillingAddress=function(t,n,r){var e=this;return this.mutationQueue.mutate({mutation:Xt(this.extraCartFragments),variables:{cartId:t,payment:this.paymentInputTransformer.transform(n),address:this.cartAddressInputTransformer.transform(r)}}).pipe(p.map(function(t){return e.cartTransformer.transform(t.data.setPaymentMethodOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.updateWithBillingAddressAndEmail=function(t,n,r){var e=this;return this.mutationQueue.mutate({mutation:Jt(this.extraCartFragments),variables:{cartId:t,email:r.email,payment:this.paymentInputTransformer.transform(n),address:this.cartAddressInputTransformer.transform(r)}}).pipe(p.map(function(t){return e.cartTransformer.transform(t.data.setGuestEmailOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:x},{type:I},{type:w},{type:O},{type:Array,decorators:[{type:n.Inject,args:[z]}]}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(x),n.ɵɵinject(I),n.ɵɵinject(w),n.ɵɵinject(O),n.ɵɵinject(z))},token:t,providedIn:"root"}),t}();var Sn=function(){function t(t,n,r){this.apollo=t,this.extraCartFragments=n,this.paymentTransformer=r}return t.prototype.list=function(t){var n=this;return this.apollo.query({query:Ut(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.available_payment_methods.map(function(t){return n.paymentTransformer.transform(t)})}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:I}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(z),n.ɵɵinject(I))},token:t,providedIn:"root"}),t}();var $n=function(){function t(t,n,r,e,a,i){this.apollo=t,this.mutationQueue=n,this.extraCartFragments=r,this.cartTransformer=e,this.billingAddressTransformer=a,this.billingAddressInputTransformer=i}return t.prototype.get=function(t){var n=this;return this.apollo.query({query:Kt(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.billing_address?n.billingAddressTransformer.transform(f({},t.data.cart.billing_address,{email:t.data.cart.email})):null}))},t.prototype.update=function(t,n){return n.email?this.updateAddressWithEmail(t,n):this.updateAddress(t,n)},t.prototype.updateAddress=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Yt(this.extraCartFragments),variables:{cartId:t,address:this.billingAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setBillingAddressOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.updateAddressWithEmail=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Zt(this.extraCartFragments),variables:{cartId:t,email:n.email,address:this.billingAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(f({},t.data.setBillingAddressOnCart.cart,{email:t.data.setGuestEmailOnCart.cart.email}))}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:x},{type:S},{type:O}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(x),n.ɵɵinject(S),n.ɵɵinject(O))},token:t,providedIn:"root"}),t}();var An=function(){function t(t,n,r,e,a,i){this.apollo=t,this.mutationQueue=n,this.extraCartFragments=r,this.cartTransformer=e,this.shippingAddressTransformer=a,this.shippingAddressInputTransformer=i}return t.prototype.get=function(t){var n=this;return this.apollo.query({query:tn(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.shipping_addresses[0]?n.shippingAddressTransformer.transform(f({},t.data.cart.shipping_addresses[0],{email:t.data.cart.email})):null}))},t.prototype.update=function(t,n){return n.email?this.updateAddressWithEmail(t,n):this.updateAddress(t,n)},t.prototype.updateAddress=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:nn(this.extraCartFragments),variables:{cartId:t,address:this.shippingAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setShippingAddressesOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.updateAddressWithEmail=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:rn(this.extraCartFragments),variables:{cartId:t,email:n.email,address:this.shippingAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(f({},t.data.setShippingAddressesOnCart.cart,{email:t.data.setGuestEmailOnCart.cart.email}))}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:x},{type:b},{type:E}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(x),n.ɵɵinject(b),n.ɵɵinject(E))},token:t,providedIn:"root"}),t}();var Tn=function(){function t(t,n,r){this.apollo=t,this.extraCartFragments=n,this.shippingRateTransformer=r}return t.prototype.list=function(t){var n=this;return this.apollo.query({query:Vt(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.shipping_addresses[0].available_shipping_methods.map(function(t){return n.shippingRateTransformer.transform(t)})}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:_}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(z),n.ɵɵinject(_))},token:t,providedIn:"root"}),t}();var jn=function(){function t(t,n,r,e,a,i){this.apollo=t,this.mutationQueue=n,this.extraCartFragments=r,this.cartTransformer=e,this.shippingRateTransformer=a,this.shippingMethodInputTransformer=i}return t.prototype.get=function(t){var n=this;return this.apollo.query({query:zt(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.shipping_addresses[0]?n.shippingRateTransformer.transform(t.data.cart.shipping_addresses[0].selected_shipping_method):null}))},t.prototype.update=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Ht(this.extraCartFragments),variables:{cartId:t,method:this.shippingMethodInputTransformer.transform(n)}}).pipe(p.switchMap(function(n){return r.apollo.query({query:Vt(r.extraCartFragments),variables:{cartId:t},fetchPolicy:"network-only"}).pipe(p.map(function(t){return f({},r.cartTransformer.transform(n.data.setShippingMethodsOnCart.cart),{available_shipping_methods:t.data.cart.shipping_addresses[0].available_shipping_methods.map(function(t){return r.shippingRateTransformer.transform(t)})})}))}))},t.prototype.delete=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:Ht(this.extraCartFragments),variables:{cartId:t,method:{carrier_code:"",method_code:""}}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setShippingMethodsOnCart.cart)}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:d.Apollo},{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:x},{type:_},{type:Q}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(d.Apollo),n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(x),n.ɵɵinject(_),n.ɵɵinject(Q))},token:t,providedIn:"root"}),t}();var Dn=function(){function t(t,n,r,e,a){this.mutationQueue=t,this.extraCartFragments=n,this.cartTransformer=r,this.cartAddressTransformer=e,this.cartAddressInputTransformer=a}return t.prototype.update=function(t,n){return n.email?this.updateAddressWithEmail(t,n):this.updateAddress(t,n)},t.prototype.updateAddress=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:en(this.extraCartFragments),variables:{cartId:t,address:this.cartAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setShippingAddressesOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.updateAddressWithEmail=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:an(this.extraCartFragments),variables:{cartId:t,email:n.email,address:this.cartAddressInputTransformer.transform(n)}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.setGuestEmailOnCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:x},{type:b},{type:P}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(x),n.ɵɵinject(b),n.ɵɵinject(P))},token:t,providedIn:"root"}),t}();var Mn=function(){function t(t,n){this.mutationQueue=t,this.cartTransformer=n}return t.prototype.placeOrder=function(t,n){return this.mutationQueue.mutate({mutation:sn,variables:{cartId:t}}).pipe(p.map(function(n){return{id:n.data.placeOrder.order.order_number,orderId:n.data.placeOrder.order.order_number,cartId:t}}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:x}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(yn),n.ɵɵinject(x))},token:t,providedIn:"root"}),t}();var Fn=function(){function t(){}return t.prototype.transformCartItems=function(t){return{items:t.items.map(M)}},t.prototype.transformTotals=function(t){return{grand_total:t.prices.grand_total.value,subtotal:t.prices.subtotal_excluding_tax.value}},t.prototype.transformCoupons=function(t){return{coupons:t.applied_coupons?t.applied_coupons.map($):[]}},t.prototype.transform=function(t){return t?f({},this.transformCartItems(t),this.transformCoupons(t),this.transformTotals(t),F(t),{id:t.id}):null},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),Bn=function(){function t(t,n,r){this.mutationQueue=t,this.extraCartFragments=n,this.cartTransformer=r}return t.prototype.apply=function(t,n){var r=this;return this.mutationQueue.mutate({mutation:un(this.extraCartFragments),variables:{cartId:t,couponCode:n.code}}).pipe(p.map(function(t){return r.cartTransformer.transform(t.data.applyCouponToCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.list=function(t){return this.mutationQueue.mutate({mutation:cn(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return t.data.cart.applied_coupons.map($)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.prototype.remove=function(t,n){return this.removeAll(t)},t.prototype.removeAll=function(t){var n=this;return this.mutationQueue.mutate({mutation:ln(this.extraCartFragments),variables:{cartId:t}}).pipe(p.map(function(t){return n.cartTransformer.transform(t.data.removeCouponFromCart.cart)}),p.catchError(function(t){return s.throwError(hn(t))}))},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.DaffQueuedApollo,decorators:[{type:n.Inject,args:[yn]}]},{type:Array,decorators:[{type:n.Inject,args:[z]}]},{type:Fn}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(yn),n.ɵɵinject(z),n.ɵɵinject(Fn))},token:t,providedIn:"root"}),t}();var xn=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:u.DaffCartDriver,useExisting:In},{provide:u.DaffCartItemDriver,useExisting:Cn},{provide:u.DaffCartAddressDriver,useExisting:Dn},{provide:u.DaffCartBillingAddressDriver,useExisting:$n},{provide:u.DaffCartShippingAddressDriver,useExisting:An},{provide:u.DaffCartShippingMethodsDriver,useExisting:Tn},{provide:u.DaffCartShippingInformationDriver,useExisting:jn},{provide:u.DaffCartPaymentDriver,useExisting:bn},{provide:u.DaffCartPaymentMethodsDriver,useExisting:Sn},{provide:u.DaffCartOrderDriver,useExisting:Mn},{provide:u.DaffCartCouponDriver,useExisting:Bn},S,C,I,v,_,x,b,Fn,P,E,O,q,w,Q]}},t.decorators=[{type:n.NgModule,args:[{imports:[m.CommonModule]}]}],t}();t.DAFF_CART_MAGENTO_EXTRA_CART_FRAGMENTS=z,t.DaffCartMagentoDriverModule=xn,t.DaffMagentoBillingAddressInputTransformer=O,t.DaffMagentoBillingAddressTransformer=S,t.DaffMagentoCartAddressInputTransformer=P,t.DaffMagentoCartAddressTransformer=C,t.DaffMagentoCartBillingAddressService=$n,t.DaffMagentoCartItemService=Cn,t.DaffMagentoCartItemUpdateInputTransformer=q,t.DaffMagentoCartPaymentMethodsService=Sn,t.DaffMagentoCartPaymentService=bn,t.DaffMagentoCartPaymentTransformer=I,t.DaffMagentoCartService=In,t.DaffMagentoCartShippingAddressService=An,t.DaffMagentoCartShippingInformationService=jn,t.DaffMagentoCartShippingInformationTransformer=v,t.DaffMagentoCartShippingMethodsService=Tn,t.DaffMagentoCartShippingRateTransformer=_,t.DaffMagentoCartTransformer=x,t.DaffMagentoPaymentMethodInputTransformer=w,t.DaffMagentoShippingAddressInputTransformer=E,t.DaffMagentoShippingAddressTransformer=b,t.DaffMagentoShippingMethodInputTransformer=Q,t.MagentoCartItemTypeEnum=A,t.addBundleCartItem=kt,t.addConfigurableCartItem=Nt,t.addSimpleCartItem=Qt,t.applyCoupon=un,t.availablePaymentMethodFragment=tt,t.availableShippingMethodFragment=rt,t.cartAddressFragment=Y,t.cartCouponFragment=K,t.cartFragment=it,t.cartItemFragment=Z,t.createCart=dn,t.getBillingAddress=Kt,t.getCart=on,t.getSelectedPaymentMethod=Wt,t.getSelectedShippingMethod=zt,t.getShippingAddress=tn,t.listCartCoupons=cn,t.listCartItems=wt,t.listPaymentMethods=Ut,t.listShippingMethods=Vt,t.moneyFragment=H,t.placeOrder=sn,t.pricesFragment=at,t.removeAllCoupons=ln,t.removeCartItem=Gt,t.selectedPaymentMethodFragment=nt,t.selectedShippingMethodFragment=et,t.setSelectedPaymentMethod=Lt,t.setSelectedPaymentMethodWithBilling=Xt,t.setSelectedPaymentMethodWithBillingAndEmail=Jt,t.setSelectedShippingMethod=Ht,t.updateAddress=en,t.updateAddressWithEmail=an,t.updateBillingAddress=Yt,t.updateBillingAddressWithEmail=Zt,t.updateCartItem=Rt,t.updateShippingAddress=nn,t.updateShippingAddressWithEmail=rn,t.ɵa=yn,t.ɵb=Dn,t.ɵc=Mn,t.ɵd=Bn,t.ɵe=Fn,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=daffodil-cart-driver-magento.umd.min.js.map